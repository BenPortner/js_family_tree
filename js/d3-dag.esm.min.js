// d3-dag Version 0.11.4. Copyright 2022 Erik Brinkman.
var Vn=Object.create;var rt=Object.defineProperty,Pn=Object.defineProperties,Bn=Object.getOwnPropertyDescriptor,Rn=Object.getOwnPropertyDescriptors,_n=Object.getOwnPropertyNames,Se=Object.getOwnPropertySymbols,Wn=Object.getPrototypeOf,nt=Object.prototype.hasOwnProperty,Zt=Object.prototype.propertyIsEnumerable;var Ht=(e,t,r)=>t in e?rt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,A=(e,t)=>{for(var r in t||(t={}))nt.call(t,r)&&Ht(e,r,t[r]);if(Se)for(var r of Se(t))Zt.call(t,r)&&Ht(e,r,t[r]);return e},T=(e,t)=>Pn(e,Rn(t));var B=(e,t)=>{var r={};for(var n in e)nt.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&Se)for(var n of Se(e))t.indexOf(n)<0&&Zt.call(e,n)&&(r[n]=e[n]);return r};var R=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var $n=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of _n(t))!nt.call(e,o)&&o!==r&&rt(e,o,{get:()=>t[o],enumerable:!(n=Bn(t,o))||n.enumerable});return e};var Ie=(e,t,r)=>(r=e!=null?Vn(Wn(e)):{},$n(t||!e||!e.__esModule?rt(r,"default",{value:e,enumerable:!0}):r,e));var it=R((ci,Xt)=>{"use strict";var Gn=function(e,t){return e<t};function G(e){if(!(this instanceof G))return new G(e);this.array=[],this.size=0,this.compare=e||Gn}G.prototype.clone=function(){var e=new G(this.compare);return e.size=this.size,e.array=this.array.slice(0,this.size),e};G.prototype.add=function(e){var t=this.size;this.array[this.size]=e,this.size+=1;for(var r,n;t>0&&(r=t-1>>1,n=this.array[r],!!this.compare(e,n));)this.array[t]=n,t=r;this.array[t]=e};G.prototype.heapify=function(e){this.array=e,this.size=e.length;var t;for(t=this.size>>1;t>=0;t--)this._percolateDown(t)};G.prototype._percolateUp=function(e,t){for(var r=this.array[e],n,o;e>0&&(n=e-1>>1,o=this.array[n],!(!t&&!this.compare(r,o)));)this.array[e]=o,e=n;this.array[e]=r};G.prototype._percolateDown=function(e){for(var t=this.size,r=this.size>>>1,n=this.array[e],o,a,i;e<r&&(o=(e<<1)+1,a=o+1,i=this.array[o],a<t&&this.compare(this.array[a],i)&&(o=a,i=this.array[a]),!!this.compare(i,n));)this.array[e]=i,e=o;this.array[e]=n};G.prototype._removeAt=function(e){if(!(e>this.size-1||e<0))return this._percolateUp(e,!0),this.poll()};G.prototype.remove=function(e){for(var t=0;t<this.size;t++)if(!this.compare(this.array[t],e)&&!this.compare(e,this.array[t]))return this._removeAt(t),!0;return!1};G.prototype.removeOne=function(e){if(typeof e=="function"){for(var t=0;t<this.size;t++)if(e(this.array[t]))return this._removeAt(t)}};G.prototype.removeMany=function(e,t){if(typeof e!="function"||this.size<1)return[];t=t?Math.min(t,this.size):this.size;for(var r=0,n=new Array(t),o=0,a=new Array(this.size);r<t&&!this.isEmpty();){var i=this.poll();e(i)?n[r++]=i:a[o++]=i}n.length=r;for(var s=0;s<o;)this.add(a[s++]);return n};G.prototype.peek=function(){if(this.size!=0)return this.array[0]};G.prototype.poll=function(){if(this.size!=0){var e=this.array[0];return this.size>1?(this.array[0]=this.array[--this.size],this._percolateDown(0)):this.size-=1,e}};G.prototype.replaceTop=function(e){if(this.size!=0){var t=this.array[0];return this.array[0]=e,this._percolateDown(0),t}};G.prototype.trim=function(){this.array=this.array.slice(0,this.size)};G.prototype.isEmpty=function(){return this.size===0};G.prototype.forEach=function(e){if(!(this.isEmpty()||typeof e!="function"))for(var t=0,r=this.clone();!r.isEmpty();)e(r.poll(),t++)};G.prototype.kSmallest=function(e){if(this.size==0)return[];e=Math.min(this.size,e);var t=new G(this.compare);let r=Math.min((e>0?Math.pow(2,e-1):0)+1,this.size);t.size=r,t.array=this.array.slice(0,r);for(var n=new Array(e),o=0;o<e;o++)n[o]=t.poll();return n};Xt.exports=G});var gt=R((Xi,dr)=>{function ur(e,t,r,n){this.feasible=r,this.evaluation=t,this.bounded=n,this._tableau=e}dr.exports=ur;ur.prototype.generateSolutionSet=function(){for(var e={},t=this._tableau,r=t.varIndexByRow,n=t.variablesPerIndex,o=t.matrix,a=t.rhsColumn,i=t.height-1,s=Math.round(1/t.precision),u=1;u<=i;u+=1){var l=r[u],d=n[l];if(!(d===void 0||d.isSlack===!0)){var c=o[u][a];e[d.id]=Math.round((Number.EPSILON+c)*s)/s}}return e}});var fr=R((ea,cr)=>{var lr=gt();function Be(e,t,r,n,o){lr.call(this,e,t,r,n),this.iter=o}cr.exports=Be;Be.prototype=Object.create(lr.prototype);Be.constructor=Be});var K=R((ta,pr)=>{var co=gt(),fo=fr();function ee(e){this.model=null,this.matrix=null,this.width=0,this.height=0,this.costRowIndex=0,this.rhsColumn=0,this.variablesPerIndex=[],this.unrestrictedVars=null,this.feasible=!0,this.evaluation=0,this.simplexIters=0,this.varIndexByRow=null,this.varIndexByCol=null,this.rowByVarIndex=null,this.colByVarIndex=null,this.precision=e||1e-8,this.optionalObjectives=[],this.objectivesByPriority={},this.savedState=null,this.availableIndexes=[],this.lastElementIndex=0,this.variables=null,this.nVars=0,this.bounded=!0,this.unboundedVarIndex=null,this.branchAndCutIterations=0}pr.exports=ee;ee.prototype.solve=function(){return this.model.getNumberOfIntegerVariables()>0?this.branchAndCut():this.simplex(),this.updateVariableValues(),this.getSolution()};function vt(e,t){this.priority=e,this.reducedCosts=new Array(t);for(var r=0;r<t;r+=1)this.reducedCosts[r]=0}vt.prototype.copy=function(){var e=new vt(this.priority,this.reducedCosts.length);return e.reducedCosts=this.reducedCosts.slice(),e};ee.prototype.setOptionalObjective=function(e,t,r){var n=this.objectivesByPriority[e];if(n===void 0){var o=Math.max(this.width,t+1);n=new vt(e,o),this.objectivesByPriority[e]=n,this.optionalObjectives.push(n),this.optionalObjectives.sort(function(a,i){return a.priority-i.priority})}n.reducedCosts[t]=r};ee.prototype.initialize=function(e,t,r,n){this.variables=r,this.unrestrictedVars=n,this.width=e,this.height=t;for(var o=new Array(e),a=0;a<e;a++)o[a]=0;this.matrix=new Array(t);for(var i=0;i<t;i++)this.matrix[i]=o.slice();this.varIndexByRow=new Array(this.height),this.varIndexByCol=new Array(this.width),this.varIndexByRow[0]=-1,this.varIndexByCol[0]=-1,this.nVars=e+t-2,this.rowByVarIndex=new Array(this.nVars),this.colByVarIndex=new Array(this.nVars),this.lastElementIndex=this.nVars};ee.prototype._resetMatrix=function(){var e=this.model.variables,t=this.model.constraints,r=e.length,n=t.length,o,a,i=this.matrix[0],s=this.model.isMinimization===!0?-1:1;for(o=0;o<r;o+=1){var u=e[o],l=u.priority,d=s*u.cost;l===0?i[o+1]=d:this.setOptionalObjective(l,o+1,d),a=e[o].index,this.rowByVarIndex[a]=-1,this.colByVarIndex[a]=o+1,this.varIndexByCol[o+1]=a}for(var c=1,p=0;p<n;p+=1){var m=t[p],v=m.index;this.rowByVarIndex[v]=c,this.colByVarIndex[v]=-1,this.varIndexByRow[c]=v;var f,N,h,x=m.terms,y=x.length,b=this.matrix[c++];if(m.isUpperBound){for(f=0;f<y;f+=1)N=x[f],h=this.colByVarIndex[N.variable.index],b[h]=N.coefficient;b[0]=m.rhs}else{for(f=0;f<y;f+=1)N=x[f],h=this.colByVarIndex[N.variable.index],b[h]=-N.coefficient;b[0]=-m.rhs}}};ee.prototype.setModel=function(e){this.model=e;var t=e.nVariables+1,r=e.nConstraints+1;return this.initialize(t,r,e.variables,e.unrestrictedVariables),this._resetMatrix(),this};ee.prototype.getNewElementIndex=function(){if(this.availableIndexes.length>0)return this.availableIndexes.pop();var e=this.lastElementIndex;return this.lastElementIndex+=1,e};ee.prototype.density=function(){for(var e=0,t=this.matrix,r=0;r<this.height;r++)for(var n=t[r],o=0;o<this.width;o++)n[o]!==0&&(e+=1);return e/(this.height*this.width)};ee.prototype.setEvaluation=function(){var e=Math.round(1/this.precision),t=this.matrix[this.costRowIndex][this.rhsColumn],r=Math.round((Number.EPSILON+t)*e)/e;this.evaluation=r,this.simplexIters===0&&(this.bestPossibleEval=r)};ee.prototype.getSolution=function(){var e=this.model.isMinimization===!0?this.evaluation:-this.evaluation;return this.model.getNumberOfIntegerVariables()>0?new fo(this,e,this.feasible,this.bounded,this.branchAndCutIterations):new co(this,e,this.feasible,this.bounded)}});var hr=R(()=>{var De=K();De.prototype.simplex=function(){return this.bounded=!0,this.phase1(),this.feasible===!0&&this.phase2(),this};De.prototype.phase1=function(){for(var e=this.model.checkForCycles,t=[],r=this.matrix,n=this.rhsColumn,o=this.width-1,a=this.height-1,i,s=0;;){for(var u=0,l=-this.precision,d=1;d<=a;d++){i=this.unrestrictedVars[this.varIndexByRow[d]]===!0;var c=r[d][n];c<l&&(l=c,u=d)}if(u===0)return this.feasible=!0,s;for(var p=0,m=-1/0,v=r[0],f=r[u],N=1;N<=o;N++){var h=f[N];if(i=this.unrestrictedVars[this.varIndexByCol[N]]===!0,i||h<-this.precision){var x=-v[N]/h;m<x&&(m=x,p=N)}}if(p===0)return this.feasible=!1,s;if(e){t.push([this.varIndexByRow[u],this.varIndexByCol[p]]);var y=this.checkForCycles(t);if(y.length>0)return this.model.messages.push("Cycle in phase 1"),this.model.messages.push("Start :"+y[0]),this.model.messages.push("Length :"+y[1]),this.feasible=!1,s}this.pivot(u,p),s+=1}};De.prototype.phase2=function(){for(var e=this.model.checkForCycles,t=[],r=this.matrix,n=this.rhsColumn,o=this.width-1,a=this.height-1,i=this.precision,s=this.optionalObjectives.length,u=null,l=0,d,c;;){var p=r[this.costRowIndex];s>0&&(u=[]);for(var m=0,v=i,f=!1,N=1;N<=o;N++){if(d=p[N],c=this.unrestrictedVars[this.varIndexByCol[N]]===!0,s>0&&-i<d&&d<i){u.push(N);continue}if(c&&d<0){-d>v&&(v=-d,m=N,f=!0);continue}d>v&&(v=d,m=N,f=!1)}if(s>0)for(var h=0;m===0&&u.length>0&&h<s;){var x=[],y=this.optionalObjectives[h].reducedCosts;v=i;for(var b=0;b<u.length;b++){if(N=u[b],d=y[N],c=this.unrestrictedVars[this.varIndexByCol[N]]===!0,-i<d&&d<i){x.push(N);continue}if(c&&d<0){-d>v&&(v=-d,m=N,f=!0);continue}d>v&&(v=d,m=N,f=!1)}u=x,h+=1}if(m===0)return this.setEvaluation(),this.simplexIters+=1,l;for(var w=0,O=1/0,L=this.varIndexByRow,D=1;D<=a;D++){var S=r[D],C=S[n],z=S[m];if(!(-i<z&&z<i)){if(z>0&&i>C&&C>-i){O=0,w=D;break}var k=f?-C/z:C/z;k>i&&O>k&&(O=k,w=D)}}if(O===1/0)return this.evaluation=-1/0,this.bounded=!1,this.unboundedVarIndex=this.varIndexByCol[m],l;if(e){t.push([this.varIndexByRow[w],this.varIndexByCol[m]]);var V=this.checkForCycles(t);if(V.length>0)return this.model.messages.push("Cycle in phase 2"),this.model.messages.push("Start :"+V[0]),this.model.messages.push("Length :"+V[1]),this.feasible=!1,l}this.pivot(w,m,!0),l+=1}};var Nt=[];De.prototype.pivot=function(e,t){var r=this.matrix,n=r[e][t],o=this.height-1,a=this.width-1,i=this.varIndexByRow[e],s=this.varIndexByCol[t];this.varIndexByRow[e]=s,this.varIndexByCol[t]=i,this.rowByVarIndex[s]=e,this.rowByVarIndex[i]=-1,this.colByVarIndex[s]=-1,this.colByVarIndex[i]=t;for(var u=r[e],l=0,d=0;d<=a;d++)u[d]>=-1e-16&&u[d]<=1e-16?u[d]=0:(u[d]/=n,Nt[l]=d,l+=1);u[t]=1/n;for(var c,p,m,v=this.precision,f=0;f<=o;f++)if(f!==e&&!(r[f][t]>=-1e-16&&r[f][t]<=1e-16)){var N=r[f];if(c=N[t],c>=-1e-16&&c<=1e-16)c!==0&&(N[t]=0);else{for(p=0;p<l;p++)d=Nt[p],m=u[d],m>=-1e-16&&m<=1e-16?m!==0&&(u[d]=0):N[d]=N[d]-c*m;N[t]=-c/n}}var h=this.optionalObjectives.length;if(h>0)for(var x=0;x<h;x+=1){var y=this.optionalObjectives[x].reducedCosts;if(c=y[t],c!==0){for(p=0;p<l;p++)d=Nt[p],m=u[d],m!==0&&(y[d]=y[d]-c*m);y[t]=-c/n}}};De.prototype.checkForCycles=function(e){for(var t=0;t<e.length-1;t++)for(var r=t+1;r<e.length;r++){var n=e[t],o=e[r];if(n[0]===o[0]&&n[1]===o[1]){if(r-t>e.length-r)break;for(var a=!0,i=1;i<r-t;i++){var s=e[t+i],u=e[r+i];if(s[0]!==u[0]||s[1]!==u[1]){a=!1;break}}if(a)return[t,r-t]}}return[]}});var Re=R((oa,Nr)=>{function xt(e,t,r,n){this.id=e,this.cost=t,this.index=r,this.value=0,this.priority=n}function mr(e,t,r,n){xt.call(this,e,t,r,n)}mr.prototype.isInteger=!0;function bt(e,t){xt.call(this,e,0,t,0)}bt.prototype.isSlack=!0;function gr(e,t){this.variable=e,this.coefficient=t}function vr(e,t,r){return r===0||r==="required"?null:(t=t||1,r=r||1,e.isMinimization===!1&&(t=-t),e.addVariable(t,"r"+e.relaxationIndex++,!1,!1,r))}function de(e,t,r,n){this.slack=new bt("s"+r,r),this.index=r,this.model=n,this.rhs=e,this.isUpperBound=t,this.terms=[],this.termsByVarIndex={},this.relaxation=null}de.prototype.addTerm=function(e,t){var r=t.index,n=this.termsByVarIndex[r];if(n===void 0)n=new gr(t,e),this.termsByVarIndex[r]=n,this.terms.push(n),this.isUpperBound===!0&&(e=-e),this.model.updateConstraintCoefficient(this,t,e);else{var o=n.coefficient+e;this.setVariableCoefficient(o,t)}return this};de.prototype.removeTerm=function(e){return this};de.prototype.setRightHandSide=function(e){if(e!==this.rhs){var t=e-this.rhs;this.isUpperBound===!0&&(t=-t),this.rhs=e,this.model.updateRightHandSide(this,t)}return this};de.prototype.setVariableCoefficient=function(e,t){var r=t.index;if(r===-1){console.warn("[Constraint.setVariableCoefficient] Trying to change coefficient of inexistant variable.");return}var n=this.termsByVarIndex[r];if(n===void 0)this.addTerm(e,t);else if(e!==n.coefficient){var o=e-n.coefficient;this.isUpperBound===!0&&(o=-o),n.coefficient=e,this.model.updateConstraintCoefficient(this,t,o)}return this};de.prototype.relax=function(e,t){this.relaxation=vr(this.model,e,t),this._relax(this.relaxation)};de.prototype._relax=function(e){e!==null&&(this.isUpperBound?this.setVariableCoefficient(-1,e):this.setVariableCoefficient(1,e))};function ve(e,t){this.upperBound=e,this.lowerBound=t,this.model=e.model,this.rhs=e.rhs,this.relaxation=null}ve.prototype.isEquality=!0;ve.prototype.addTerm=function(e,t){return this.upperBound.addTerm(e,t),this.lowerBound.addTerm(e,t),this};ve.prototype.removeTerm=function(e){return this.upperBound.removeTerm(e),this.lowerBound.removeTerm(e),this};ve.prototype.setRightHandSide=function(e){this.upperBound.setRightHandSide(e),this.lowerBound.setRightHandSide(e),this.rhs=e};ve.prototype.relax=function(e,t){this.relaxation=vr(this.model,e,t),this.upperBound.relaxation=this.relaxation,this.upperBound._relax(this.relaxation),this.lowerBound.relaxation=this.relaxation,this.lowerBound._relax(this.relaxation)};Nr.exports={Constraint:de,Variable:xt,IntegerVariable:mr,SlackVariable:bt,Equality:ve,Term:gr}});var xr=R(()=>{var _e=K(),Ot=Re().SlackVariable;_e.prototype.addCutConstraints=function(e){for(var t=e.length,r=this.height,n=r+t,o=r;o<n;o+=1)this.matrix[o]===void 0&&(this.matrix[o]=this.matrix[o-1].slice());this.height=n,this.nVars=this.width+this.height-2;for(var a,i=this.width-1,s=0;s<t;s+=1){var u=e[s],l=r+s,d=u.type==="min"?-1:1,c=u.varIndex,p=this.rowByVarIndex[c],m=this.matrix[l];if(p===-1){for(m[this.rhsColumn]=d*u.value,a=1;a<=i;a+=1)m[a]=0;m[this.colByVarIndex[c]]=d}else{var v=this.matrix[p],f=v[this.rhsColumn];for(m[this.rhsColumn]=d*(u.value-f),a=1;a<=i;a+=1)m[a]=-d*v[a]}var N=this.getNewElementIndex();this.varIndexByRow[l]=N,this.rowByVarIndex[N]=l,this.colByVarIndex[N]=-1,this.variablesPerIndex[N]=new Ot("s"+N,N),this.nVars+=1}};_e.prototype._addLowerBoundMIRCut=function(e){if(e===this.costRowIndex)return!1;var t=this.model,r=this.matrix,n=this.variablesPerIndex[this.varIndexByRow[e]];if(!n.isInteger)return!1;var o=r[e][this.rhsColumn],a=o-Math.floor(o);if(a<this.precision||1-this.precision<a)return!1;var i=this.height;r[i]=r[i-1].slice(),this.height+=1,this.nVars+=1;var s=this.getNewElementIndex();this.varIndexByRow[i]=s,this.rowByVarIndex[s]=i,this.colByVarIndex[s]=-1,this.variablesPerIndex[s]=new Ot("s"+s,s),r[i][this.rhsColumn]=Math.floor(o);for(var u=1;u<this.varIndexByCol.length;u+=1){var l=this.variablesPerIndex[this.varIndexByCol[u]];if(!l.isInteger)r[i][u]=Math.min(0,r[e][u]/(1-a));else{var d=r[e][u],c=Math.floor(d)+Math.max(0,d-Math.floor(d)-a)/(1-a);r[i][u]=c}}for(var p=0;p<this.width;p+=1)r[i][p]-=r[e][p];return!0};_e.prototype._addUpperBoundMIRCut=function(e){if(e===this.costRowIndex)return!1;var t=this.model,r=this.matrix,n=this.variablesPerIndex[this.varIndexByRow[e]];if(!n.isInteger)return!1;var o=r[e][this.rhsColumn],a=o-Math.floor(o);if(a<this.precision||1-this.precision<a)return!1;var i=this.height;r[i]=r[i-1].slice(),this.height+=1,this.nVars+=1;var s=this.getNewElementIndex();this.varIndexByRow[i]=s,this.rowByVarIndex[s]=i,this.colByVarIndex[s]=-1,this.variablesPerIndex[s]=new Ot("s"+s,s),r[i][this.rhsColumn]=-a;for(var u=1;u<this.varIndexByCol.length;u+=1){var l=this.variablesPerIndex[this.varIndexByCol[u]],d=r[e][u],c=d-Math.floor(d);l.isInteger?c<=a?r[i][u]=-c:r[i][u]=-(1-c)*a/c:d>=0?r[i][u]=-d:r[i][u]=d*a/(1-a)}return!0};_e.prototype.applyMIRCuts=function(){}});var br=R(()=>{var te=K();te.prototype._putInBase=function(e){var t=this.rowByVarIndex[e];if(t===-1){for(var r=this.colByVarIndex[e],n=1;n<this.height;n+=1){var o=this.matrix[n][r];if(o<-this.precision||this.precision<o){t=n;break}}this.pivot(t,r)}return t};te.prototype._takeOutOfBase=function(e){var t=this.colByVarIndex[e];if(t===-1){for(var r=this.rowByVarIndex[e],n=this.matrix[r],o=1;o<this.height;o+=1){var a=n[o];if(a<-this.precision||this.precision<a){t=o;break}}this.pivot(r,t)}return t};te.prototype.updateVariableValues=function(){for(var e=this.variables.length,t=Math.round(1/this.precision),r=0;r<e;r+=1){var n=this.variables[r],o=n.index,a=this.rowByVarIndex[o];if(a===-1)n.value=0;else{var i=this.matrix[a][this.rhsColumn];n.value=Math.round((i+Number.EPSILON)*t)/t}}};te.prototype.updateRightHandSide=function(e,t){var r=this.height-1,n=this.rowByVarIndex[e.index];if(n===-1){for(var o=this.colByVarIndex[e.index],a=0;a<=r;a+=1){var i=this.matrix[a];i[this.rhsColumn]-=t*i[o]}var s=this.optionalObjectives.length;if(s>0)for(var u=0;u<s;u+=1){var l=this.optionalObjectives[u].reducedCosts;l[this.rhsColumn]-=t*l[o]}}else this.matrix[n][this.rhsColumn]-=t};te.prototype.updateConstraintCoefficient=function(e,t,r){if(e.index===t.index)throw new Error("[Tableau.updateConstraintCoefficient] constraint index should not be equal to variable index !");var n=this._putInBase(e.index),o=this.colByVarIndex[t.index];if(o===-1)for(var a=this.rowByVarIndex[t.index],i=0;i<this.width;i+=1)this.matrix[n][i]+=r*this.matrix[a][i];else this.matrix[n][o]-=r};te.prototype.updateCost=function(e,t){var r=e.index,n=this.width-1,o=this.colByVarIndex[r];if(o===-1){var a=this.matrix[this.rowByVarIndex[r]],i;if(e.priority===0){var s=this.matrix[0];for(i=0;i<=n;i+=1)s[i]+=t*a[i]}else{var u=this.objectivesByPriority[e.priority].reducedCosts;for(i=0;i<=n;i+=1)u[i]+=t*a[i]}}else this.matrix[0][o]-=t};te.prototype.addConstraint=function(e){var t=e.isUpperBound?1:-1,r=this.height,n=this.matrix[r];n===void 0&&(n=this.matrix[0].slice(),this.matrix[r]=n);for(var o=this.width-1,a=0;a<=o;a+=1)n[a]=0;n[this.rhsColumn]=t*e.rhs;for(var i=e.terms,s=i.length,u=0;u<s;u+=1){var l=i[u],d=l.coefficient,c=l.variable.index,p=this.rowByVarIndex[c];if(p===-1)n[this.colByVarIndex[c]]+=t*d;else{var m=this.matrix[p],v=m[this.rhsColumn];for(a=0;a<=o;a+=1)n[a]-=t*d*m[a]}}var f=e.index;this.varIndexByRow[r]=f,this.rowByVarIndex[f]=r,this.colByVarIndex[f]=-1,this.height+=1};te.prototype.removeConstraint=function(e){var t=e.index,r=this.height-1,n=this._putInBase(t),o=this.matrix[r];this.matrix[r]=this.matrix[n],this.matrix[n]=o,this.varIndexByRow[n]=this.varIndexByRow[r],this.varIndexByRow[r]=-1,this.rowByVarIndex[t]=-1,this.availableIndexes[this.availableIndexes.length]=t,e.slack.index=-1,this.height-=1};te.prototype.addVariable=function(e){var t=this.height-1,r=this.width,n=this.model.isMinimization===!0?-e.cost:e.cost,o=e.priority,a=this.optionalObjectives.length;if(a>0)for(var i=0;i<a;i+=1)this.optionalObjectives[i].reducedCosts[r]=0;o===0?this.matrix[0][r]=n:(this.setOptionalObjective(o,r,n),this.matrix[0][r]=0);for(var s=1;s<=t;s+=1)this.matrix[s][r]=0;var u=e.index;this.varIndexByCol[r]=u,this.rowByVarIndex[u]=-1,this.colByVarIndex[u]=r,this.width+=1};te.prototype.removeVariable=function(e){var t=e.index,r=this._takeOutOfBase(t),n=this.width-1;if(r!==n){for(var o=this.height-1,a=0;a<=o;a+=1){var i=this.matrix[a];i[r]=i[n]}var s=this.optionalObjectives.length;if(s>0)for(var u=0;u<s;u+=1){var l=this.optionalObjectives[u].reducedCosts;l[r]=l[n]}var d=this.varIndexByCol[n];this.varIndexByCol[r]=d,this.colByVarIndex[d]=r}this.varIndexByCol[n]=-1,this.colByVarIndex[t]=-1,this.availableIndexes[this.availableIndexes.length]=t,e.index=-1,this.width-=1}});var Or=R(()=>{var po=K();po.prototype.log=function(e,t){console.log("****",e,"****"),console.log("Nb Variables",this.width-1),console.log("Nb Constraints",this.height-1),console.log("Basic Indexes",this.varIndexByRow),console.log("Non Basic Indexes",this.varIndexByCol),console.log("Rows",this.rowByVarIndex),console.log("Cols",this.colByVarIndex);var r=5,n="",o=[" "],a,i,s,u,l,d,c,p,m,v,f,N,h;for(i=1;i<this.width;i+=1)d=this.varIndexByCol[i],l=this.variablesPerIndex[d],l===void 0?c="c"+d:c=l.id,p=c.length,m=Math.abs(p-5),v=" ",f="	",p>5?v+=" ":f+="	",o[i]=v,n+=f+c;console.log(n);var x,y=this.matrix[this.costRowIndex],b="	";for(a=1;a<this.width;a+=1)x="	",b+=x,b+=o[a],b+=y[a].toFixed(r);for(x="	",b+=x+o[0]+y[0].toFixed(r),console.log(b+"	Z"),u=1;u<this.height;u+=1){for(N=this.matrix[u],h="	",i=1;i<this.width;i+=1)x="	",h+=x+o[i]+N[i].toFixed(r);x="	",h+=x+o[0]+N[0].toFixed(r),d=this.varIndexByRow[u],l=this.variablesPerIndex[d],l===void 0?c="c"+d:c=l.id,console.log(h+"	"+c)}console.log("");var w=this.optionalObjectives.length;if(w>0){console.log("    Optional objectives:");for(var O=0;O<w;O+=1){var L=this.optionalObjectives[O].reducedCosts,D="";for(a=1;a<this.width;a+=1)x=L[a]<0?"":" ",D+=x,D+=o[a],D+=L[a].toFixed(r);x=L[0]<0?"":" ",D+=x+o[0]+L[0].toFixed(r),console.log(D+" z"+O)}}return console.log("Feasible?",this.feasible),console.log("evaluation",this.evaluation),this}});var yr=R(()=>{var We=K();We.prototype.copy=function(){var e=new We(this.precision);e.width=this.width,e.height=this.height,e.nVars=this.nVars,e.model=this.model,e.variables=this.variables,e.variablesPerIndex=this.variablesPerIndex,e.unrestrictedVars=this.unrestrictedVars,e.lastElementIndex=this.lastElementIndex,e.varIndexByRow=this.varIndexByRow.slice(),e.varIndexByCol=this.varIndexByCol.slice(),e.rowByVarIndex=this.rowByVarIndex.slice(),e.colByVarIndex=this.colByVarIndex.slice(),e.availableIndexes=this.availableIndexes.slice();for(var t=[],r=0;r<this.optionalObjectives.length;r++)t[r]=this.optionalObjectives[r].copy();e.optionalObjectives=t;for(var n=this.matrix,o=new Array(this.height),a=0;a<this.height;a++)o[a]=n[a].slice();return e.matrix=o,e};We.prototype.save=function(){this.savedState=this.copy()};We.prototype.restore=function(){if(this.savedState!==null){var e=this.savedState,t=e.matrix;this.nVars=e.nVars,this.model=e.model,this.variables=e.variables,this.variablesPerIndex=e.variablesPerIndex,this.unrestrictedVars=e.unrestrictedVars,this.lastElementIndex=e.lastElementIndex,this.width=e.width,this.height=e.height;var r,n;for(r=0;r<this.height;r+=1){var o=t[r],a=this.matrix[r];for(n=0;n<this.width;n+=1)a[n]=o[n]}var i=e.varIndexByRow;for(n=0;n<this.height;n+=1)this.varIndexByRow[n]=i[n];for(;this.varIndexByRow.length>this.height;)this.varIndexByRow.pop();var s=e.varIndexByCol;for(r=0;r<this.width;r+=1)this.varIndexByCol[r]=s[r];for(;this.varIndexByCol.length>this.width;)this.varIndexByCol.pop();for(var u=e.rowByVarIndex,l=e.colByVarIndex,d=0;d<this.nVars;d+=1)this.rowByVarIndex[d]=u[d],this.colByVarIndex[d]=l[d];if(e.optionalObjectives.length>0&&this.optionalObjectives.length>0){this.optionalObjectives=[],this.optionalObjectivePerPriority={};for(var c=0;c<e.optionalObjectives.length;c++){var p=e.optionalObjectives[c].copy();this.optionalObjectives[c]=p,this.optionalObjectivePerPriority[p.priority]=p}}}}});var Lr=R(()=>{var wr=K();function Dr(e,t){this.index=e,this.value=t}wr.prototype.getMostFractionalVar=function(){for(var e=0,t=null,r=null,n=.5,o=this.model.integerVariables,a=o.length,i=0;i<a;i++){var s=o[i].index,u=this.rowByVarIndex[s];if(u!==-1){var l=this.matrix[u][this.rhsColumn],d=Math.abs(l-Math.round(l));e<d&&(e=d,t=s,r=l)}}return new Dr(t,r)};wr.prototype.getFractionalVarWithLowestCost=function(){for(var e=1/0,t=null,r=null,n=this.model.integerVariables,o=n.length,a=0;a<o;a++){var i=n[a],s=i.index,u=this.rowByVarIndex[s];if(u!==-1){var l=this.matrix[u][this.rhsColumn];if(Math.abs(l-Math.round(l))>this.precision){var d=i.cost;e>d&&(e=d,t=s,r=l)}}}return new Dr(t,r)}});var Cr=R(()=>{var yt=K();yt.prototype.countIntegerValues=function(){for(var e=0,t=1;t<this.height;t+=1)if(this.variablesPerIndex[this.varIndexByRow[t]].isInteger){var r=this.matrix[t][this.rhsColumn];r=r-Math.floor(r),r<this.precision&&-r<this.precision&&(e+=1)}return e};yt.prototype.isIntegral=function(){for(var e=this.model.integerVariables,t=e.length,r=0;r<t;r++){var n=this.rowByVarIndex[e[r].index];if(n!==-1){var o=this.matrix[n][this.rhsColumn];if(Math.abs(o-Math.round(o))>this.precision)return!1}}return!0};yt.prototype.computeFractionalVolume=function(e){for(var t=-1,r=1;r<this.height;r+=1)if(this.variablesPerIndex[this.varIndexByRow[r]].isInteger){var n=this.matrix[r][this.rhsColumn];n=Math.abs(n);var o=Math.min(n-Math.floor(n),Math.floor(n+1));if(o<this.precision){if(!e)return 0}else t===-1?t=n:t*=n}return t===-1?0:t}});var Ir=R((va,Sr)=>{hr();xr();br();Or();yr();Lr();Cr();Sr.exports=K()});var Dt=R(()=>{var zr=K();function kr(e,t,r){this.type=e,this.varIndex=t,this.value=r}function wt(e,t){this.relaxedEvaluation=e,this.cuts=t}function ho(e,t){return t.relaxedEvaluation-e.relaxedEvaluation}zr.prototype.applyCuts=function(e){if(this.restore(),this.addCutConstraints(e),this.simplex(),this.model.useMIRCuts)for(var t=!0;t;){var r=this.computeFractionalVolume(!0);this.applyMIRCuts(),this.simplex();var n=this.computeFractionalVolume(!0);n>=.9*r&&(t=!1)}};zr.prototype.branchAndCut=function(){var e=[],t=0,r=this.model.tolerance,n=!0,o=1e99;this.model.timeout&&(o=Date.now()+this.model.timeout);for(var a=1/0,i=null,s=[],u=0;u<this.optionalObjectives.length;u+=1)s.push(1/0);var l=new wt(-1/0,[]),d;for(e.push(l);e.length>0&&n===!0&&Date.now()<o;)if(this.model.isMinimization?d=this.bestPossibleEval*(1+r):d=this.bestPossibleEval*(1-r),r>0&&a<d&&(n=!1),l=e.pop(),!(l.relaxedEvaluation>a)){var c=l.cuts;if(this.applyCuts(c),t++,this.feasible!==!1){var p=this.evaluation;if(!(p>a)){if(p===a){for(var m=!0,v=0;v<this.optionalObjectives.length&&!(this.optionalObjectives[v].reducedCosts[0]>s[v]);v+=1)if(this.optionalObjectives[v].reducedCosts[0]<s[v]){m=!1;break}if(m)continue}if(this.isIntegral()===!0){if(this.__isIntegral=!0,t===1){this.branchAndCutIterations=t;return}i=l,a=p;for(var f=0;f<this.optionalObjectives.length;f+=1)s[f]=this.optionalObjectives[f].reducedCosts[0]}else{t===1&&this.save();for(var N=this.getMostFractionalVar(),h=N.index,x=[],y=[],b=c.length,w=0;w<b;w+=1){var O=c[w];O.varIndex===h?O.type==="min"?y.push(O):x.push(O):(x.push(O),y.push(O))}var L=Math.ceil(N.value),D=Math.floor(N.value),S=new kr("min",h,L);x.push(S);var C=new kr("max",h,D);y.push(C),e.push(new wt(p,x)),e.push(new wt(p,y)),e.sort(ho)}}}}i!==null&&this.applyCuts(i.cuts),this.branchAndCutIterations=t}});var Tr=R((ya,Ar)=>{var mo=K(),ba=Dt(),Le=Re(),$e=Le.Constraint,Mr=Le.Equality,go=Le.Variable,vo=Le.IntegerVariable,Oa=Le.Term;function U(e,t){this.tableau=new mo(e),this.name=t,this.variables=[],this.integerVariables=[],this.unrestrictedVariables={},this.constraints=[],this.nConstraints=0,this.nVariables=0,this.isMinimization=!0,this.tableauInitialized=!1,this.relaxationIndex=1,this.useMIRCuts=!1,this.checkForCycles=!0,this.messages=[]}Ar.exports=U;U.prototype.minimize=function(){return this.isMinimization=!0,this};U.prototype.maximize=function(){return this.isMinimization=!1,this};U.prototype._getNewElementIndex=function(){if(this.availableIndexes.length>0)return this.availableIndexes.pop();var e=this.lastElementIndex;return this.lastElementIndex+=1,e};U.prototype._addConstraint=function(e){var t=e.slack;this.tableau.variablesPerIndex[t.index]=t,this.constraints.push(e),this.nConstraints+=1,this.tableauInitialized===!0&&this.tableau.addConstraint(e)};U.prototype.smallerThan=function(e){var t=new $e(e,!0,this.tableau.getNewElementIndex(),this);return this._addConstraint(t),t};U.prototype.greaterThan=function(e){var t=new $e(e,!1,this.tableau.getNewElementIndex(),this);return this._addConstraint(t),t};U.prototype.equal=function(e){var t=new $e(e,!0,this.tableau.getNewElementIndex(),this);this._addConstraint(t);var r=new $e(e,!1,this.tableau.getNewElementIndex(),this);return this._addConstraint(r),new Mr(t,r)};U.prototype.addVariable=function(e,t,r,n,o){if(typeof o=="string")switch(o){case"required":o=0;break;case"strong":o=1;break;case"medium":o=2;break;case"weak":o=3;break;default:o=0;break}var a=this.tableau.getNewElementIndex();t==null&&(t="v"+a),e==null&&(e=0),o==null&&(o=0);var i;return r?(i=new vo(t,e,a,o),this.integerVariables.push(i)):i=new go(t,e,a,o),this.variables.push(i),this.tableau.variablesPerIndex[a]=i,n&&(this.unrestrictedVariables[a]=!0),this.nVariables+=1,this.tableauInitialized===!0&&this.tableau.addVariable(i),i};U.prototype._removeConstraint=function(e){var t=this.constraints.indexOf(e);if(t===-1){console.warn("[Model.removeConstraint] Constraint not present in model");return}this.constraints.splice(t,1),this.nConstraints-=1,this.tableauInitialized===!0&&this.tableau.removeConstraint(e),e.relaxation&&this.removeVariable(e.relaxation)};U.prototype.removeConstraint=function(e){return e.isEquality?(this._removeConstraint(e.upperBound),this._removeConstraint(e.lowerBound)):this._removeConstraint(e),this};U.prototype.removeVariable=function(e){var t=this.variables.indexOf(e);if(t===-1){console.warn("[Model.removeVariable] Variable not present in model");return}return this.variables.splice(t,1),this.tableauInitialized===!0&&this.tableau.removeVariable(e),this};U.prototype.updateRightHandSide=function(e,t){return this.tableauInitialized===!0&&this.tableau.updateRightHandSide(e,t),this};U.prototype.updateConstraintCoefficient=function(e,t,r){return this.tableauInitialized===!0&&this.tableau.updateConstraintCoefficient(e,t,r),this};U.prototype.setCost=function(e,t){var r=e-t.cost;return this.isMinimization===!1&&(r=-r),t.cost=e,this.tableau.updateCost(t,r),this};U.prototype.loadJson=function(e){this.isMinimization=e.opType!=="max";for(var t=e.variables,r=e.constraints,n={},o={},a=Object.keys(r),i=a.length,s=0;s<i;s+=1){var u=a[s],l=r[u],d=l.equal,c=l.weight,p=l.priority,m=c!==void 0||p!==void 0,v,f;if(d===void 0){var N=l.min;N!==void 0&&(v=this.greaterThan(N),n[u]=v,m&&v.relax(c,p));var h=l.max;h!==void 0&&(f=this.smallerThan(h),o[u]=f,m&&f.relax(c,p))}else{v=this.greaterThan(d),n[u]=v,f=this.smallerThan(d),o[u]=f;var x=new Mr(v,f);m&&x.relax(c,p)}}var y=Object.keys(t),b=y.length;this.tolerance=e.tolerance||0,e.timeout&&(this.timeout=e.timeout),e.options&&(e.options.timeout&&(this.timeout=e.options.timeout),this.tolerance===0&&(this.tolerance=e.options.tolerance||0),e.options.useMIRCuts&&(this.useMIRCuts=e.options.useMIRCuts),typeof e.options.exitOnCycles>"u"?this.checkForCycles=!0:this.checkForCycles=e.options.exitOnCycles);for(var w=e.ints||{},O=e.binaries||{},L=e.unrestricted||{},D=e.optimize,S=0;S<b;S+=1){var C=y[S],z=t[C],k=z[D]||0,V=!!O[C],E=!!w[C]||V,P=!!L[C],M=this.addVariable(k,C,E,P);V&&this.smallerThan(1).addTerm(1,M);var $=Object.keys(z);for(s=0;s<$.length;s+=1){var F=$[s];if(F!==D){var q=z[F],W=n[F];W!==void 0&&W.addTerm(q,M);var ne=o[F];ne!==void 0&&ne.addTerm(q,M)}}}return this};U.prototype.getNumberOfIntegerVariables=function(){return this.integerVariables.length};U.prototype.solve=function(){return this.tableauInitialized===!1&&(this.tableau.setModel(this),this.tableauInitialized=!0),this.tableau.solve()};U.prototype.isFeasible=function(){return this.tableau.feasible};U.prototype.save=function(){return this.tableau.save()};U.prototype.restore=function(){return this.tableau.restore()};U.prototype.activateMIRCuts=function(e){this.useMIRCuts=e};U.prototype.debug=function(e){this.checkForCycles=e};U.prototype.log=function(e){return this.tableau.log(e)}});var Vr=R(Er=>{Er.CleanObjectiveAttributes=function(e){var t,r,n;if(typeof e.optimize=="string")if(e.constraints[e.optimize]){t=Math.random();for(r in e.variables)e.variables[r][e.optimize]&&(e.variables[r][t]=e.variables[r][e.optimize]);return e.constraints[t]=e.constraints[e.optimize],delete e.constraints[e.optimize],e}else return e;else{for(n in e.optimize)if(e.constraints[n])if(e.constraints[n]==="equal")delete e.optimize[n];else{t=Math.random();for(r in e.variables)e.variables[r][n]&&(e.variables[r][t]=e.variables[r][n]);e.constraints[t]=e.constraints[n],delete e.constraints[n]}return e}}});var Ue=R((Da,Pr)=>{function No(e){var t={is_blank:/^\W{0,}$/,is_objective:/(max|min)(imize){0,}\:/i,is_int:/^(?!\/\*)\W{0,}int/i,is_bin:/^(?!\/\*)\W{0,}bin/i,is_constraint:/(\>|\<){0,}\=/i,is_unrestricted:/^\S{0,}unrestricted/i,parse_lhs:/(\-|\+){0,1}\s{0,1}\d{0,}\.{0,}\d{0,}\s{0,}[A-Za-z]\S{0,}/gi,parse_rhs:/(\-|\+){0,1}\d{1,}\.{0,}\d{0,}\W{0,}\;{0,1}$/i,parse_dir:/(\>|\<){0,}\=/gi,parse_int:/[^\s|^\,]+/gi,parse_bin:/[^\s|^\,]+/gi,get_num:/(\-|\+){0,1}(\W|^)\d+\.{0,1}\d{0,}/g,get_word:/[A-Za-z].*/},r={opType:"",optimize:"_obj",constraints:{},variables:{}},n={">=":"min","<=":"max","=":"equal"},o="",a=0,i=null,s="",u="",l="",d=0;typeof e=="string"&&(e=e.split(`
`));for(var c=0;c<e.length;c++)if(l="__"+c,o=e[c],a=0,i=null,t.is_objective.test(o))r.opType=o.match(/(max|min)/gi)[0],i=o.match(t.parse_lhs).map(function(v){return v.replace(/\s+/,"")}).slice(1),i.forEach(function(v){s=v.match(t.get_num),s===null?v.substr(0,1)==="-"?s=-1:s=1:s=s[0],s=parseFloat(s),u=v.match(t.get_word)[0].replace(/\;$/,""),r.variables[u]=r.variables[u]||{},r.variables[u]._obj=s});else if(t.is_int.test(o))i=o.match(t.parse_int).slice(1),r.ints=r.ints||{},i.forEach(function(v){v=v.replace(";",""),r.ints[v]=1});else if(t.is_bin.test(o))i=o.match(t.parse_bin).slice(1),r.binaries=r.binaries||{},i.forEach(function(v){v=v.replace(";",""),r.binaries[v]=1});else if(t.is_constraint.test(o)){var p=o.indexOf(":"),m=p===-1?o:o.slice(p+1);i=m.match(t.parse_lhs).map(function(v){return v.replace(/\s+/,"")}),i.forEach(function(v){s=v.match(t.get_num),s===null?v.substr(0,1)==="-"?s=-1:s=1:s=s[0],s=parseFloat(s),u=v.match(t.get_word)[0],r.variables[u]=r.variables[u]||{},r.variables[u][l]=s}),d=parseFloat(o.match(t.parse_rhs)[0]),o=n[o.match(t.parse_dir)[0]],r.constraints[l]=r.constraints[l]||{},r.constraints[l][o]=d}else t.is_unrestricted.test(o)&&(i=o.match(t.parse_int).slice(1),r.unrestricted=r.unrestricted||{},i.forEach(function(v){v=v.replace(";",""),r.unrestricted[v]=1}));return r}function xo(e){if(!e)throw new Error("Solver requires a model to operate on");var t="",r=[],n=1,o={max:"<=",min:">=",equal:"="},a=new RegExp("[^A-Za-z0-9_[{}/.&#$%~'@^]","gi");if(e.opType){t+=e.opType+":";for(var i in e.variables)e.variables[i][i]=e.variables[i][i]?e.variables[i][i]:1,e.variables[i][e.optimize]&&(t+=" "+e.variables[i][e.optimize]+" "+i.replace(a,"_"))}else t+="max:";t+=`;

`;for(var s in e.constraints)for(var u in e.constraints[s])if(typeof o[u]<"u"){for(var l in e.variables)typeof e.variables[l][s]<"u"&&(t+=" "+e.variables[l][s]+" "+l.replace(a,"_"));t+=" "+o[u]+" "+e.constraints[s][u],t+=`;
`}if(e.ints){t+=`

`;for(var d in e.ints)t+="int "+d.replace(a,"_")+`;
`}if(e.unrestricted){t+=`

`;for(var c in e.unrestricted)t+="unrestricted "+c.replace(a,"_")+`;
`}return t}Pr.exports=function(e){return e.length?No(e):xo(e)}});var Br=R(()=>{});var Rr=R(()=>{});var Wr=R(Lt=>{Lt.reformat=Ue();function _r(e){return e=e.replace("\\r\\n",`\r
`),e=e.split(`\r
`),e=e.filter(function(t){var r;return r=new RegExp(" 0$","gi"),!(r.test(t)===!0||(r=new RegExp("\\d$","gi"),r.test(t)===!1))}).map(function(t){return t.split(/\:{0,1} +(?=\d)/)}).reduce(function(t,r,n){return t[r[0]]=r[1],t},{}),e}Lt.solve=function(e){return new Promise(function(t,r){typeof window<"u"&&r("Function Not Available in Browser");var n=Ue()(e);e.external||r("Data for this function must be contained in the 'external' attribute. Not seeing anything there."),e.external.binPath||r("No Executable | Binary path provided in arguments as 'binPath'"),e.external.args||r("No arguments array for cli | bash provided on 'args' attribute"),e.external.tempName||r("No 'tempName' given. This is necessary to produce a staging file for the solver to operate on");var o=Br();o.writeFile(e.external.tempName,n,function(a,i){if(a)r(a);else{var s=Rr().execFile;e.external.args.push(e.external.tempName),s(e.external.binPath,e.external.args,function(u,l){if(u)if(u.code===1)t(_r(l));else{var d={"-2":"Out of Memory",1:"SUBOPTIMAL",2:"INFEASIBLE",3:"UNBOUNDED",4:"DEGENERATE",5:"NUMFAILURE",6:"USER-ABORT",7:"TIMEOUT",9:"PRESOLVED",25:"ACCURACY ERROR",255:"FILE-ERROR"},c={code:u.code,meaning:d[u.code],data:l};r(c)}else t(_r(l))})}})})}});var Ur=R((za,$r)=>{$r.exports={lpsolve:Wr()}});var Ct=R((Ma,Gr)=>{Gr.exports=function(e,t){var r=t.optimize,n=JSON.parse(JSON.stringify(t.optimize)),o=Object.keys(t.optimize),a,i=0,s={},u="",l={},d=[],c,p,m,v,f;for(delete t.optimize,c=0;c<o.length;c++)n[o[c]]=0;for(c=0;c<o.length;c++){t.optimize=o[c],t.opType=r[o[c]],a=e.Solve(t,void 0,void 0,!0);for(v in o)if(!t.variables[o[v]]){a[o[v]]=a[o[v]]?a[o[v]]:0;for(m in t.variables)t.variables[m][o[v]]&&a[m]&&(a[o[v]]+=a[m]*t.variables[m][o[v]])}for(u="base",p=0;p<o.length;p++)a[o[p]]?u+="-"+(a[o[p]]*1e3|0)/1e3:u+="-0";if(!s[u]){for(s[u]=1,i++,p=0;p<o.length;p++)a[o[p]]&&(n[o[p]]+=a[o[p]]);delete a.feasible,delete a.result,d.push(a)}}for(c=0;c<o.length;c++)t.constraints[o[c]]={equal:n[o[c]]/i};t.optimize="cheater-"+Math.random(),t.opType="max";for(c in t.variables)t.variables[c].cheater=1;for(c in d)for(m in d[c])l[m]=l[m]||{min:1e99,max:-1e99};for(c in l)for(m in d)d[m][c]?(d[m][c]>l[c].max&&(l[c].max=d[m][c]),d[m][c]<l[c].min&&(l[c].min=d[m][c])):(d[m][c]=0,l[c].min=0);return a=e.Solve(t,void 0,void 0,!0),{midpoint:a,vertices:d,ranges:l}}});var jr=R((Aa,Fr)=>{var bo=Ir(),St=Tr(),Oo=Dt(),Fe=Re(),qr=Vr(),yo=Fe.Constraint,wo=Fe.Variable,Do=Fe.Numeral,Lo=Fe.Term,Ge=Ur(),qe=function(){"use strict";this.Model=St,this.branchAndCut=Oo,this.Constraint=yo,this.Variable=wo,this.Numeral=Do,this.Term=Lo,this.Tableau=bo,this.lastSolvedModel=null,this.External=Ge,this.Solve=function(e,t,r,n){if(n)for(var o in qr)e=qr[o](e);if(!e)throw new Error("Solver requires a model to operate on");if(typeof e.optimize=="object"&&Object.keys(e.optimize>1))return Ct()(this,e);if(e.external){var a=Object.keys(Ge);if(a=JSON.stringify(a),!e.external.solver)throw new Error("The model you provided has an 'external' object that doesn't have a solver attribute. Use one of the following:"+a);if(!Ge[e.external.solver])throw new Error("No support (yet) for "+e.external.solver+". Please use one of these instead:"+a);return Ge[e.external.solver].solve(e)}else{e instanceof St||(e=new St(t).loadJson(e));var i=e.solve();if(this.lastSolvedModel=e,i.solutionSet=i.generateSolutionSet(),r)return i;var s={};return s.feasible=i.feasible,s.result=i.evaluation,s.bounded=i.bounded,i._tableau.__isIntegral&&(s.isIntegral=!0),Object.keys(i.solutionSet).forEach(function(u){i.solutionSet[u]!==0&&(s[u]=i.solutionSet[u])}),s}},this.ReformatLP=Ue(),this.MultiObjective=function(e){return Ct()(this,e)}};typeof define=="function"?define([],function(){return new qe}):typeof window=="object"?window.solver=new qe:typeof self=="object"&&(self.solver=new qe);Fr.exports=new qe});var Kr=R(($a,Jr)=>{"use strict";var Ce=1e-60,Zr,Qr;do Ce+=Ce,Zr=1+.1*Ce,Qr=1+.2*Ce;while(Zr<=1||Qr<=1);Jr.exports=Ce});var Xr=R((Ua,Yr)=>{"use strict";function Io(e,t,r){let n,o;for(let a=1;a<=r;a+=1){e[a][a]=1/e[a][a],o=-e[a][a];for(let i=1;i<a;i+=1)e[i][a]*=o;if(n=a+1,r<n)break;for(let i=n;i<=r;i+=1){o=e[a][i],e[a][i]=0;for(let s=1;s<=a;s+=1)e[s][i]+=o*e[s][a]}}}Yr.exports=Io});var tn=R((Ga,en)=>{"use strict";function ko(e,t,r,n){let o,a;for(o=1;o<=r;o+=1){a=0;for(let i=1;i<o;i+=1)a+=e[i][o]*n[i];n[o]=(n[o]-a)/e[o][o]}for(let i=1;i<=r;i+=1){o=r+1-i,n[o]/=e[o][o],a=-n[o];for(let s=1;s<o;s+=1)n[s]+=a*e[s][o]}}en.exports=ko});var nn=R((qa,rn)=>{"use strict";function zo(e,t,r,n){let o,a,i;for(let s=1;s<=r;s+=1){if(n[1]=s,i=0,o=s-1,o<1){if(i=e[s][s]-i,i<=0)break;e[s][s]=Math.sqrt(i)}else{for(let u=1;u<=o;u+=1){a=e[u][s];for(let l=1;l<u;l+=1)a-=e[l][s]*e[l][u];a/=e[u][u],e[u][s]=a,i+=a*a}if(i=e[s][s]-i,i<=0)break;e[s][s]=Math.sqrt(i)}n[1]=0}}rn.exports=zo});var an=R((Fa,on)=>{"use strict";var kt=Kr(),Mo=Xr(),Ao=tn(),To=nn();function Eo(e,t,r,n,o,a,i,s,u,l,d,c,p,m=0,v,f,N){let h,x,y,b,w,O,L,D,S,C,z,k,V,E,P=Math.min(n,d),M=2*n+P*(P+5)/2+2*d+1;for(let g=1;g<=n;g+=1)f[g]=t[g];for(let g=n+1;g<=M;g+=1)f[g]=0;for(let g=1;g<=d;g+=1)p[g]=0,a[g]=0;let $=[];if(N[1]===0){if(To(e,r,n,$),$[1]!==0){N[1]=2;return}Ao(e,r,n,t),Mo(e,r,n)}else{for(let g=1;g<=n;g+=1){o[g]=0;for(let I=1;I<=g;I+=1)o[g]+=e[I][g]*t[I]}for(let g=1;g<=n;g+=1){t[g]=0;for(let I=g;I<=n;I+=1)t[g]+=e[g][I]*o[I]}}i[1]=0;for(let g=1;g<=n;g+=1){o[g]=t[g],i[1]+=f[g]*o[g],f[g]=0;for(let I=g+1;I<=n;I+=1)e[I][g]=0}i[1]=-i[1]/2,N[1]=0;let F=n,q=F+n,W=q+P,ne=W+P+1,Y=ne+P*(P+1)/2,tt=Y+d;for(let g=1;g<=d;g+=1){O=0;for(let I=1;I<=n;I+=1)O+=s[I][g]*s[I][g];f[tt+g]=Math.sqrt(O)}b=m,v[1]=0,v[2]=0;function Mn(){v[1]+=1,M=Y;for(let g=1;g<=d;g+=1){M+=1,O=-u[g];for(let I=1;I<=n;I+=1)O+=s[I][g]*o[I];if(Math.abs(O)<kt&&(O=0),g>c)f[M]=O;else if(f[M]=-Math.abs(O),O>0){for(let I=1;I<=n;I+=1)s[I][g]=-s[I][g];u[g]=-u[g]}}for(let g=1;g<=b;g+=1)f[Y+p[g]]=0;y=0,w=0;for(let g=1;g<=d;g+=1)f[Y+g]<w*f[tt+g]&&(y=g,w=f[Y+g]/f[tt+g]);if(y===0){for(let g=1;g<=b;g+=1)a[p[g]]=f[W+g];return 999}return 0}function An(){for(let g=1;g<=n;g+=1){O=0;for(let I=1;I<=n;I+=1)O+=e[I][g]*s[I][y];f[g]=O}h=F;for(let g=1;g<=n;g+=1)f[h+g]=0;for(let g=b+1;g<=n;g+=1)for(let I=1;I<=n;I+=1)f[h+I]=f[h+I]+e[I][g]*f[g];k=!0;for(let g=b;g>=1;g-=1){O=f[g],M=ne+g*(g+3)/2,h=M-g;for(let I=g+1;I<=b;I+=1)O-=f[M]*f[q+I],M+=I;O/=f[h],f[q+g]=O,!(p[g]<=c)&&(O<=0||(k=!1,x=g))}if(!k){L=f[W+x]/f[q+x];for(let g=1;g<=b;g+=1)p[g]<=c||f[q+g]<=0||(w=f[W+g]/f[q+g],w<L&&(L=w,x=g))}O=0;for(let g=F+1;g<=F+n;g+=1)O+=f[g]*f[g];if(Math.abs(O)<=kt){if(k)return N[1]=1,999;for(let g=1;g<=b;g+=1)f[W+g]=f[W+g]-L*f[q+g];return f[W+b+1]=f[W+b+1]+L,700}O=0;for(let g=1;g<=n;g+=1)O+=f[F+g]*s[g][y];D=-f[Y+y]/O,V=!0,k||L<D&&(D=L,V=!1);for(let g=1;g<=n;g+=1)o[g]+=D*f[F+g],Math.abs(o[g])<kt&&(o[g]=0);i[1]+=D*O*(D/2+f[W+b+1]);for(let g=1;g<=b;g+=1)f[W+g]=f[W+g]-D*f[q+g];if(f[W+b+1]=f[W+b+1]+D,V){b+=1,p[b]=y,M=ne+(b-1)*b/2+1;for(let g=1;g<=b-1;g+=1)f[M]=f[g],M+=1;if(b===n)f[M]=f[n];else{for(let g=n;g>=b+1;g-=1)if(f[g]!==0&&(S=Math.max(Math.abs(f[g-1]),Math.abs(f[g])),C=Math.min(Math.abs(f[g-1]),Math.abs(f[g])),f[g-1]>=0?w=Math.abs(S*Math.sqrt(1+C*C/(S*S))):w=-Math.abs(S*Math.sqrt(1+C*C/(S*S))),S=f[g-1]/w,C=f[g]/w,S!==1))if(S===0){f[g-1]=C*w;for(let I=1;I<=n;I+=1)w=e[I][g-1],e[I][g-1]=e[I][g],e[I][g]=w}else{f[g-1]=w,z=C/(1+S);for(let I=1;I<=n;I+=1)w=S*e[I][g-1]+C*e[I][g],e[I][g]=z*(e[I][g-1]+w)-e[I][g],e[I][g-1]=w}f[M]=f[b]}}else{O=-u[y];for(let g=1;g<=n;g+=1)O+=o[g]*s[g][y];if(y>c)f[Y+y]=O;else if(f[Y+y]=-Math.abs(O),O>0){for(let g=1;g<=n;g+=1)s[g][y]=-s[g][y];u[y]=-u[y]}return 700}return 0}function Tn(){if(M=ne+x*(x+1)/2+1,h=M+x,f[h]===0||(S=Math.max(Math.abs(f[h-1]),Math.abs(f[h])),C=Math.min(Math.abs(f[h-1]),Math.abs(f[h])),f[h-1]>=0?w=Math.abs(S*Math.sqrt(1+C*C/(S*S))):w=-Math.abs(S*Math.sqrt(1+C*C/(S*S))),S=f[h-1]/w,C=f[h]/w,S===1))return 798;if(S===0){for(let g=x+1;g<=b;g+=1)w=f[h-1],f[h-1]=f[h],f[h]=w,h+=g;for(let g=1;g<=n;g+=1)w=e[g][x],e[g][x]=e[g][x+1],e[g][x+1]=w}else{z=C/(1+S);for(let g=x+1;g<=b;g+=1)w=S*f[h-1]+C*f[h],f[h]=z*(f[h-1]+w)-f[h],f[h-1]=w,h+=g;for(let g=1;g<=n;g+=1)w=S*e[g][x]+C*e[g][x+1],e[g][x+1]=z*(e[g][x]+w)-e[g][x+1],e[g][x]=w}return 0}function En(){h=M-x;for(let g=1;g<=x;g+=1)f[h]=f[M],M+=1,h+=1;return f[W+x]=f[W+x+1],p[x]=p[x+1],x+=1,x<b?797:0}function jt(){return f[W+b]=f[W+b+1],f[W+b+1]=0,p[b]=0,b-=1,v[2]+=1,0}for(E=0;;){if(E=Mn(),E===999)return;for(;E=An(),E!==0;){if(E===999)return;if(E===700)if(x===b)jt();else{for(;Tn(),E=En(),E===797;);jt()}}}}on.exports=Eo});var un=R(sn=>{"use strict";var Vo=an();function Po(e,t,r,n=[],o=0,a=[0,0]){let i=[],s=[],u=[],l=[],d=[],c=[],p="",m=e.length-1,v=r[1].length-1;if(!n)for(let h=1;h<=v;h+=1)n[h]=0;if(m!==e[1].length-1&&(p="Dmat is not symmetric!"),m!==t.length-1&&(p="Dmat and dvec are incompatible!"),m!==r.length-1&&(p="Amat and dvec are incompatible!"),v!==n.length-1&&(p="Amat and bvec are incompatible!"),(o>v||o<0)&&(p="Value of meq is invalid!"),p!=="")return{message:p};for(let h=1;h<=v;h+=1)s[h]=0,l[h]=0;let f=0,N=Math.min(m,v);for(let h=1;h<=m;h+=1)u[h]=0;i[1]=0;for(let h=1;h<=2*m+N*(N+5)/2+2*v+1;h+=1)d[h]=0;for(let h=1;h<=2;h+=1)c[h]=0;return Vo(e,t,m,m,u,l,i,r,n,m,v,o,s,f,c,d,a),a[1]===1&&(p="constraints are inconsistent, no solution!"),a[1]===2&&(p="matrix D in quadratic function is not positive definite!"),{solution:u,Lagrangian:l,value:i,unconstrained_solution:t,iterations:c,iact:s,message:p}}sn.solveQP=Po});var ln=R((Ha,dn)=>{"use strict";dn.exports=un()});function*Q(e){let t=0;for(let r of e)yield[t++,r]}function*j(e,t){for(let[r,n]of Q(e))yield*t(n,r)}function ot(e,t,r){let n=r;for(let[o,a]of Q(e))n=t(n,a,o);return n}function*_(e,t){for(let[r,n]of Q(e))yield t(n,r)}function*Qt(e,t){for(let[r,n]of Q(e))t(n,r)&&(yield n)}function fe(e,t){for(let[r,n]of Q(e))if(t(n,r))return!0;return!1}function Jt(e,t){return!fe(e,(r,n)=>!t(r,n))}function*ke(e){for(let t=e.length;t!=0;)yield e[--t]}function Ne(e){if(!e)throw new Error("internal error: failed assert")}function Kt(e,t){if(t.size!==e.size)return!1;for(let r of e)if(!t.has(r))return!1;return!0}function Yt(e,t){t.size<e.size&&([t,e]=[e,t]);for(let r of e)if(t.has(r))return!0;return!1}function ze(e){let{done:t,value:r}=e.values().next();if(!t)return e.delete(r),r}function ue(e,t,r){let n=e.get(t);n===void 0?e.set(t,[r]):n.push(r)}function Me(e,t,r){let n=e.get(t);n===void 0?e.set(t,new Set([r])):n.add(r)}function Un(){let e=new WeakSet;return(t,r)=>{if(typeof r=="object"&&r!==null){if(e.has(r))return"[circular]";e.add(r)}return r}}function H(e,...t){let[r,...n]=e;return[r].concat(...n.map((o,a)=>[JSON.stringify(t[a],Un()),o])).join("")}function*Z(e){let[t,...r]=e;for(let n of r)yield[t,n],t=n}function*X(e,...t){let r=new Set,n;for(;(n=t.pop())!==void 0;)r.has(n)||(yield n,r.add(n),t.push(...e(n)))}var er=Ie(it());function J(e){let t=new Map;for(let r of e)for(let n of r.ichildren())ue(t,n,r);return t}function Ae(e){let t=new Map;for(let r of e)for(let[n,o]of r.ichildrenCounts())ue(t,n,[r,o]);return t}function*tr(e,t){var s,u;let r=new Map;for(let l of e)for(let d of l.ichildren())r.set(d,(r.get(d)||0)+1);let n=new er.default(([,l],[,d])=>l<d),o=[];function a(l){let d=t(l);d===void 0?o.push(l):n.add([l,d])}for(let l of e.iroots())a(l);let i;for(;i=(u=o.pop())!=null?u:(s=n.poll())==null?void 0:s[0];){yield i;for(let l of i.ichildren()){let d=r.get(l);d>1?r.set(l,d-1):a(l)}}}var he=class{constructor(t,r,n=[],o=!1){this.child=t;this.data=r;this.points=n;this.reversed=o}},at=class{constructor(t,r,n,o,a){this.source=t;this.target=r;this.data=n;this.points=o;this.reversed=a}},oe=class{constructor(t){t&&(this.proots=t)}[Symbol.iterator](){return this.idescendants()[Symbol.iterator]()}iroots(){return{[Symbol.iterator]:()=>this.proots[Symbol.iterator]()}}roots(){return[...this.iroots()]}*idepth(){yield*X(r=>r.ichildren(),...this.iroots())}*ibreadth(){let t=new Set,r=this.roots(),n=[];do{n=r.reverse(),r=[];let o;for(;o=n.pop();)t.has(o)||(t.add(o),yield o,r.push(...o.ichildren()))}while(r.length)}*ibefore(){let t=new Map;for(let o of this)for(let a of o.ichildren())t.set(a,(t.get(a)||0)+1);let r=this.roots(),n;for(;n=r.pop();){yield n;for(let o of n.ichildren()){let a=t.get(o);a>1?t.set(o,a-1):r.push(o)}}}*iafter(){let t=this.roots(),r=new Set,n;for(;n=t.pop();)r.has(n)||(Jt(n.ichildren(),o=>r.has(o))?(r.add(n),yield n):t.push(n,...n.ichildren()))}idescendants(t="depth"){if(t==="depth")return this.idepth();if(t==="breadth")return this.ibreadth();if(t==="before")return this.ibefore();if(t==="after")return this.iafter();throw new Error(`unknown iteration style: ${t}`)}descendants(t="depth"){return[...this.idescendants(t)]}ilinks(){return j(this,t=>t.ichildLinks())}links(){return[...this.ilinks()]}size(){return ot(this,t=>t+1,0)}sum(t){let r=new Map;for(let[n,o]of Q(this.idescendants("after"))){let a=t(o,n),i=new Map;i.set(o,a);for(let s of o.ichildren()){let u=r.get(s);for(let[l,d]of u.entries())i.set(l,d)}o.value=ot(i.values(),(s,u)=>s+u,0),r.set(o,i)}return this}count(){let t=new Map;for(let r of this.idescendants("after"))if(r.ichildren()[Symbol.iterator]().next().done)t.set(r,new Set([r])),r.value=1;else{let n=new Set;for(let o of r.ichildren()){let a=t.get(o);for(let i of a)n.add(i)}t.set(r,n),r.value=n.size}return this}height(){for(let t of this.idescendants("after"))t.value=Math.max(0,..._(t.ichildren(),r=>r.value+1));return this}depth(){var r;let t=J(this);for(let n of this.idescendants("before"))n.value=Math.max(0,..._((r=t.get(n))!=null?r:[],o=>o.value+1));return this}*isplit(){let t=J(this);function*r(o){var a;yield*o.ichildren(),yield*(a=t.get(o))!=null?a:[]}let n=new Set(this.iroots());for(let o of this.iroots()){if(!n.delete(o))continue;let a=[o];for(let i of X(r,o))n.delete(i)&&a.push(i);yield a.length>1?new oe(a):a[0]}}split(){return[...this.isplit()]}connected(){let t=this.isplit()[Symbol.iterator]();t.next();let{done:r}=t.next();return!!r}multidag(){return this.pmultidag===void 0?this.pmultidag=fe(this.iroots(),t=>t.multidag()):this.pmultidag}},me=class extends oe{constructor(r){super();this.data=r;this.dataChildren=[]}childrenCountsMap(){var r;if(this.cachedChildrenCounts===void 0){let n=new Map;for(let{child:o}of this.dataChildren)n.set(o,((r=n.get(o))!=null?r:0)+1);return this.cachedChildrenCounts=n.size===this.dataChildren.length?null:n}else return this.cachedChildrenCounts}iroots(){let r=[this];return{[Symbol.iterator]:()=>r[Symbol.iterator]()}}nchildren(){var r,n;return(n=(r=this.childrenCountsMap())==null?void 0:r.size)!=null?n:this.dataChildren.length}nchildLinks(){return this.dataChildren.length}nchildLinksTo(r){var n,o;return(o=(n=this.childrenCountsMap())==null?void 0:n.get(r))!=null?o:1}*ichildren(){let r=this.childrenCountsMap();if(r===null)for(let{child:n}of this.dataChildren)yield n;else yield*r.keys()}children(){return[...this.ichildren()]}*ichildrenCounts(){let r=this.childrenCountsMap();if(r===null)for(let{child:n}of this.dataChildren)yield[n,1];else yield*r}childrenCounts(){return[...this.ichildrenCounts()]}*ichildLinks(){for(let{child:r,data:n,points:o,reversed:a}of this.dataChildren)yield new at(this,r,n,o,a)}childLinks(){return[...this.ichildLinks()]}isplit(){return this.iroots()}split(){return this.roots()}connected(){return!0}multidag(){return this.pmultidag===void 0?this.pmultidag=this.childrenCountsMap()!==null||fe(this.ichildren(),r=>r.multidag()):this.pmultidag}};function st(e){if(typeof e!="string")throw new Error(`id is supposed to be string but got type ${typeof e}`);return e}function ut(e,t){if(!e.length)throw new Error("dag contained no roots; this often indicates a cycle");for(let i of new oe(e))for(let s of i.ichildren())if(s===i)throw new Error(H`node '${i.data}' contained a self loop`);if(!t)return;let r=new Set,n=new Set,o=null;function a(i){if(r.has(i))return[];if(n.has(i))return o=i,[i];{n.add(i);let s=[];for(let u of i.ichildren())if(s=a(u),s.length)break;return n.delete(i),r.add(i),s.length&&o!==null&&s.push(i),o===i&&(o=null),s}}for(let i of e){let s=a(i);if(s.length){let u=s.reverse().map(({data:l})=>H`'${l}'`).join(" -> ");throw new Error(`dag contained a cycle: ${u}`)}}}function qn(e){return e&&ze(e)}function dt(e){var m,v,f;let t=new Map;for(let N of e)for(let{child:h}of N.dataChildren)ue(t,h,N);let r=new Map(_(e,N=>{var h,x;return[N,{indeg:(x=(h=t.get(N))==null?void 0:h.length)!=null?x:0,outdeg:N.nchildLinks(),node:N}]})),n=Math.max(..._(Qt(r.values(),({indeg:N,outdeg:h})=>N>0&&h>0),({indeg:N,outdeg:h})=>h-N));if(n===-1/0){let N=[];for(let{indeg:h,node:x}of r.values())h===0&&N.push(x);return N}let o=new Set,a=new Set,i=new Map;for(let N of r.values()){let{outdeg:h,indeg:x}=N;if(x===0)o.add(N);else if(h===0)a.add(N);else{let y=h-x;Me(i,y,N)}}let s=0,u=e.length,l=n,d=new Array(e.length);for(;s<u;){let N=(v=(m=ze(o))!=null?m:ze(a))!=null?v:qn(i.get(l));if(N===void 0)--l;else{let{node:h,indeg:x,outdeg:y}=N,b=N.rank=x>0&&y===0?--u:s++;d[b]=h;for(let w of(f=t.get(h))!=null?f:[]){let O=r.get(w);if(O.rank===void 0&&O.indeg>0&&O.outdeg>0){let L=O.outdeg-O.indeg;i.get(L).delete(O),--O.outdeg,O.outdeg>0?Me(i,L-1,O):a.add(O)}}for(let{child:w}of h.dataChildren){let O=r.get(w);if(!(O.rank!==void 0||O.indeg===0))if(O.outdeg===0)--O.indeg,O.indeg===0&&(a.delete(O),o.add(O));else{let L=O.outdeg-O.indeg;L===l&&++l,i.get(L).delete(O),--O.indeg,O.indeg===0?o.add(O):Me(i,L+1,O)}}}}let c=[],p=new Set;for(let[N,h]of d.entries()){let x=[];for(let y of h.dataChildren){let b=r.get(y.child);b.rank<N?b.node.dataChildren.push(new he(h,y.data,y.points,!0)):x.push(y)}x.length===h.nchildLinks()&&!p.has(h)&&c.push(h);for(let{child:y}of x)p.add(y);h.dataChildren=x}return c}function Fn(e,t){let r=[];for(let[n,o]of e.entries())t.has(n)||r.push(o);return r}function pe(e){function t(s){if(!s.length)throw new Error("can't connect empty data");let u=new Map,l=new Set;for(let[c,p]of s.entries()){let m=st(e.sourceId(p,c)),v=u.get(m);v===void 0&&(v=new me(e.nodeDatum(m,c)),u.set(m,v));let f=st(e.targetId(p,c)),N=u.get(f);N===void 0&&(N=new me(e.nodeDatum(f,c)),u.set(f,N)),(m!==f||!e.single)&&(v.dataChildren.push(new he(N,p)),l.add(f))}let d=e.decycle?dt([...u.values()]):Fn(u,l);return ut(d,!e.decycle),d.length>1?new oe(d):d[0]}function r(s){if(s===void 0)return e.sourceId;{let u=e,{sourceId:l}=u,d=B(u,["sourceId"]);return pe(T(A({},d),{sourceId:s}))}}t.sourceId=r;function n(s){if(s===void 0)return e.targetId;{let u=e,{targetId:l}=u,d=B(u,["targetId"]);return pe(T(A({},d),{targetId:s}))}}t.targetId=n;function o(s){if(s===void 0)return e.nodeDatum;{let u=e,{nodeDatum:l}=u,d=B(u,["nodeDatum"]);return pe(T(A({},d),{nodeDatum:s}))}}t.nodeDatum=o;function a(s){return s===void 0?e.single:pe(T(A({},e),{single:s}))}t.single=a;function i(s){return s===void 0?e.decycle:pe(T(A({},e),{decycle:s}))}return t.decycle=i,t}function jn(e){try{return typeof e[0]=="string"}catch(t){return!1}}function Hn(e){if(jn(e))return e[0];throw new Error(`default source id expected datum[0] to be a string but got datum: ${e}`)}function Zn(e){try{return typeof e[1]=="string"}catch(t){return!1}}function Qn(e){if(Zn(e))return e[1];throw new Error(`default target id expected datum[1] to be a string but got datum: ${e}`)}function Jn(e){return{id:e}}function Kn(...e){if(e.length)throw new Error(`got arguments to connect(${e}), but constructor takes no arguments. These were probably meant as data which should be called as connect()(...)`);return pe({sourceId:Hn,targetId:Qn,nodeDatum:Jn,single:!1,decycle:!1})}function xe(e){function t(...i){var f;if(!i.length)throw new Error("must pass in at least one node");let s=new Map,u=[];function l(N){let h=s.get(N);return h===void 0&&(h=new me(N),s.set(N,h),u.push(h)),h}let d=i.map(l),c,p=0;for(;c=u.pop();)c.dataChildren=((f=e.childrenData(c.data,p++))!=null?f:[]).map(([N,h])=>new he(l(N),h));let m=new Set(d);for(let N of s.values())for(let{child:h}of N.dataChildren)if(m.delete(h)&&e.roots)throw new Error(H`node '${N.data}' pointed to a root`);let v=e.decycle?dt([...s.values()]):m.size?[...m]:d;return ut(v,!e.decycle),v.length>1?new oe(v):v[0]}function r(i){if(i===void 0)return e.children;{let s=e,{children:u,childrenData:l}=s,d=B(s,["children","childrenData"]);return xe(T(A({},d),{children:i,childrenData:or(i)}))}}t.children=r;function n(i){if(i===void 0)return e.childrenData;{let s=e,{children:u,childrenData:l}=s,d=B(s,["children","childrenData"]);return xe(T(A({},d),{children:Yn(i),childrenData:i}))}}t.childrenData=n;function o(i){return i===void 0?e.roots:xe(T(A({},e),{roots:i}))}t.roots=o;function a(i){return i===void 0?e.decycle:xe(T(A({},e),{decycle:i}))}return t.decycle=a,t}function or(e){function t(r,n){var o;return((o=e(r,n))!=null?o:[]).map(a=>[a,void 0])}return t.wrapped=e,t}function Yn(e){function t(r,n){var o;return((o=e(r,n))!=null?o:[]).map(([a])=>a)}return t.wrapped=e,t}function Xn(e){try{let t=e.children;return t===void 0||t instanceof Array}catch(t){return!1}}function rr(e){if(Xn(e))return e.children;throw new Error(H`default children function expected datum to have a children field but got: ${e}`)}function lt(...e){if(e.length)throw new Error(`got arguments to hierarchy(${e}), but constructor takes no arguments. These were probably meant as data which should be called as hierarchy()(...)`);return xe({children:rr,childrenData:or(rr),roots:!0,decycle:!1})}function be(e){function t(i){var d;if(!i.length)throw new Error("can't stratify empty data");let s=new Map;for(let[c,p]of i.entries()){let m=st(e.id(p,c)),v=(d=e.parentData(p,c))!=null?d:[],f=new me(p);if(s.has(m))throw new Error(`found a duplicate id: ${r}`);s.set(m,[f,v])}let u=[];for(let[c,p]of s.values()){for(let[m,v]of p){let f=s.get(m);if(!f)throw new Error(`missing id: ${m}`);let[N]=f;N.dataChildren.push(new he(c,v))}p.length||u.push(c)}let l=e.decycle?dt([..._(s.values(),([c])=>c)]):u;return ut(l,!e.decycle),l.length>1?new oe(l):l[0]}function r(i){if(i===void 0)return e.id;{let s=e,{id:u}=s,l=B(s,["id"]);return be(T(A({},l),{id:i}))}}t.id=r;function n(i){if(i===void 0)return e.parentData;{let s=e,{parentIds:u,parentData:l}=s,d=B(s,["parentIds","parentData"]);return be(T(A({},d),{parentIds:eo(i),parentData:i}))}}t.parentData=n;function o(i){if(i===void 0)return e.parentIds;{let s=e,{parentIds:u,parentData:l}=s,d=B(s,["parentIds","parentData"]);return be(T(A({},d),{parentIds:i,parentData:ir(i)}))}}t.parentIds=o;function a(i){return i===void 0?e.decycle:be(T(A({},e),{decycle:i}))}return t.decycle=a,t}function ir(e){function t(r,n){var o;return((o=e(r,n))!=null?o:[]).map(a=>[a,void 0])}return t.wrapped=e,t}function eo(e){function t(r,n){var o;return((o=e(r,n))!=null?o:[]).map(([a])=>a)}return t.wrapped=e,t}function to(e){try{return typeof e.id=="string"}catch(t){return!1}}function ro(e){if(to(e))return e.id;throw new Error(H`default id function expected datum to have an id field but got '${e}'`)}function no(e){try{let t=e.parentIds;return t===void 0||t instanceof Array&&t.every(r=>typeof r=="string")}catch(t){return!1}}function nr(e){if(no(e))return e.parentIds;throw new Error(`default parentIds function expected datum to have a parentIds field but got: ${e}`)}function oo(...e){if(e.length)throw new Error(`got arguments to stratify(${e}), but constructor takes no arguments. These were probably meant as data which should be called as stratify()(...)`);return be({id:ro,parentIds:nr,parentData:ir(nr),decycle:!1})}function ie(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function*ar(e,t){if(t===void 0)for(let r of e)r!=null&&(r=+r)>=r&&(yield r);else{let r=-1;for(let n of e)(n=t(n,++r,e))!=null&&(n=+n)>=n&&(yield n)}}function sr(e=ie){if(e===ie)return ct;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,r)=>{let n=e(t,r);return n||n===0?n:(e(r,r)===0)-(e(t,t)===0)}}function ct(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}function Te(e,t){let r;if(t===void 0)for(let n of e)n!=null&&(r<n||r===void 0&&n>=n)&&(r=n);else{let n=-1;for(let o of e)(o=t(o,++n,e))!=null&&(r<o||r===void 0&&o>=o)&&(r=o)}return r}function Ee(e,t){let r;if(t===void 0)for(let n of e)n!=null&&(r>n||r===void 0&&n>=n)&&(r=n);else{let n=-1;for(let o of e)(o=t(o,++n,e))!=null&&(r>o||r===void 0&&o>=o)&&(r=o)}return r}function Ve(e,t,r=0,n=e.length-1,o){for(o=o===void 0?ct:sr(o);n>r;){if(n-r>600){let u=n-r+1,l=t-r+1,d=Math.log(u),c=.5*Math.exp(2*d/3),p=.5*Math.sqrt(d*c*(u-c)/u)*(l-u/2<0?-1:1),m=Math.max(r,Math.floor(t-l*c/u+p)),v=Math.min(n,Math.floor(t+(u-l)*c/u+p));Ve(e,t,m,v,o)}let a=e[t],i=r,s=n;for(Oe(e,r,t),o(e[n],a)>0&&Oe(e,r,n);i<s;){for(Oe(e,i,s),++i,--s;o(e[i],a)<0;)++i;for(;o(e[s],a)>0;)--s}o(e[r],a)===0?Oe(e,r,s):(++s,Oe(e,s,n)),s<=t&&(r=s+1),t<=s&&(n=s-1)}return e}function Oe(e,t,r){let n=e[t];e[t]=e[r],e[r]=n}function ft(e,t,r){if(e=Float64Array.from(ar(e,r)),!!(n=e.length)){if((t=+t)<=0||n<2)return Ee(e);if(t>=1)return Te(e);var n,o=(n-1)*t,a=Math.floor(o),i=Te(Ve(e,a).subarray(0,a+1)),s=Ee(e.subarray(a+1));return i+(s-i)*(o-a)}}function ge(e,t){return ft(e,.5,t)}function ye(e,t=ie){let r,n=!1;if(t.length===1){let o;for(let a of e){let i=t(a);(n?ie(i,o)<0:ie(i,i)===0)&&(r=a,o=i,n=!0)}}else for(let o of e)(n?t(o,r)<0:t(o,o)===0)&&(r=o,n=!0);return r}var pt=class{constructor(t){this.uncompressed=t;this.indices=[]}getIndex(t,r){var i;let n=[];for(let[s,u]of this.indices.entries())u<=t&&n.push(s);this.uncompressed&&n.push(this.indices.length);let o=r!=null?r:0,a=(i=ye(n,s=>[Math.abs(o-s),s]))!=null?i:this.indices.length;return this.setIndex(a,t),a}setIndex(t,r){this.indices[t]=r}offset(){return 0}},ht=class{constructor(t){this.uncompressed=t;this.posIndices=[0];this.negIndices=[]}nextNeg(){return-this.negIndices.length-1}nextPos(){return this.posIndices.length}getIndex(t,r){var s;let n=[];for(let[u,l]of this.negIndices.entries())l<=t&&n.push(-u-1);for(let[u,l]of this.posIndices.entries())l<=t&&n.push(u);this.uncompressed&&(n.push(this.nextNeg()),n.push(this.nextPos()));let o=r!=null?r:0,a=this.negIndices.length<this.posIndices.length-1?this.nextNeg():this.nextPos(),i=(s=ye(n,u=>[Math.abs(o-u),Math.abs(u),-u]))!=null?s:a;return this.setIndex(i,t),i}setIndex(t,r){t<0?this.negIndices[-t-1]=r:this.posIndices[t]=r}offset(){return this.negIndices.length}};function io(e,t){return t?new ht(!e):new pt(!e)}function ao(e,t){for(let n of e)n.x=void 0;for(let n of e){n.x===void 0&&(n.x=t.getIndex(n.y));for(let o of[...n.ichildren()].sort((a,i)=>i.y-a.y))o.x===void 0&&(o.x=t.getIndex(n.y,n.x),t.setIndex(o.x,o.y))}let r=t.offset();for(let n of e)n.x+=r}function so(e,t){var o;let r=new Map;for(let a of e){a.x=void 0;for(let i of a.ichildren()){let s=r.get(i);(s===void 0||a.y<s.y)&&r.set(i,a)}}for(let a of ke(e)){if(a.x===void 0){let s=ge(_(a.ichildren(),u=>u.x));a.x=t.getIndex(e.length-a.y,s)}let i=r.get(a);i!==void 0&&((o=i.x)!=null||(i.x=a.x),t.setIndex(a.x,e.length-i.y))}let n=t.offset();for(let a of e)a.x+=n}function Pe(e,t,r){function n(s){let u=io(t,r);e?ao(s,u):so(s,u)}function o(s){return s===void 0?e:Pe(s,t,r)}n.topDown=o;function a(s){return s===void 0?t:Pe(e,s,r)}n.compressed=a;function i(s){return s===void 0?r:Pe(e,t,s)}return n.bidirectional=i,n}function mt(...e){if(e.length)throw new Error(`got arguments to greedy(${e}), but constructor takes no arguments.`);return Pe(!0,!0,!1)}function uo(e){for(let n of e){if(n.x===void 0)throw new Error(H`coord didn't assign an x to node '${n}'`);if(n.x<0)throw new Error(`coord assigned an x (${n.x}) less than 0`)}let t=new Set(e.map(n=>n.x));if(!Kt(t,new Set(_(t,(n,o)=>o)))){let n=[...t].join(", ");throw new Error(`didn't assign increasing positive integers for x coordinates: ${n}`)}let r=new Map;for(let[n,o]of e.entries()){let a=r.get(o);if(a!==void 0){for(let i of e.slice(a+1,n))if(i.x===o.x)throw new Error(H`node ${i} was assigned an overlapping lane with ${o}`)}for(let i of o.ichildren())r.has(i)||r.set(i,n)}return t.size}function we(e){function t(i){if(i.multidag())throw new Error("grid layout doesn't make sense to apply to multidags, consider pruning the edges");let{nodeWidth:s,nodeHeight:u,size:l,lane:d}=e,c=[...tr(i,e.rank)];for(let[f,N]of c.entries())N.y=f;d(c);let p=uo(c);for(let f of c)f.x=(f.x+.5)*s,f.y=(f.y+.5)*u;let m=p*s,v=c.length*u;if(l!==null){let[f,N]=l;for(let h of c)h.x*=f/m,h.y*=N/v;m=f,v=N}for(let{source:f,target:N,points:h}of i.ilinks())h.length=0,f.x!==N.x&&h.push({x:f.x,y:f.y}),h.push({x:N.x,y:f.y}),h.push({x:N.x,y:N.y});return{width:m,height:v}}function r(i){if(i===void 0)return e.lane;{let s=e,{lane:u}=s,l=B(s,["lane"]);return we(T(A({},l),{lane:i}))}}t.lane=r;function n(i){if(i===void 0)return e.rank;{let s=e,{rank:u}=s,l=B(s,["rank"]);return we(T(A({},l),{rank:i}))}}t.rank=n;function o(i){if(i===void 0){let{nodeWidth:s,nodeHeight:u}=e;return[s,u]}else{let[s,u]=i;return we(T(A({},e),{nodeWidth:s,nodeHeight:u}))}}t.nodeSize=o;function a(i){if(i!==void 0)return we(T(A({},e),{size:i}));if(e.size===null)return null;{let[s,u]=e.size;return[s,u]}}return t.size=a,t}function lo(...e){if(e.length)throw new Error(`got arguments to grid(${e}), but constructor takes no arguments.`);return we({lane:mt(),rank:()=>{},nodeWidth:1,nodeHeight:1,size:null})}var Hr=Ie(jr());function re(e,t,r,n,o={}){let s=Hr.Solve.call({},{optimize:e,opType:t,constraints:n,variables:r,ints:o}),{feasible:a}=s,i=B(s,["feasible"]);if(!a)throw new Error("could not find a feasible simplex solution");return i}function Co(e){let t=[],r=new Set;for(let n of e){if(!r.has(n)){let o=t.findIndex(i=>i<=n.y),a=o===-1?t.length:o;t[a]=n.y}for(let o of[...n.ichildren()].sort((a,i)=>i.y-a.y))if(!r.has(o)){let a=t.findIndex(s=>s<=n.y),i=a===-1?t.length:a;t[i]=o.y,r.add(o)}}return t.length}function It(e,t){function r(a){var m,v,f;let i={},s={},u={},l=new Map(_(a,(N,h)=>[N,h])),d=e?Co(a):a.length-1;for(let N of a.keys())i[N]={opt:0,[N]:1},s[N]={max:d-1};let c=new Map;for(let[N,h]of a.entries()){let x=c.get(h);if(x!==void 0)for(let[y,b]of a.slice(x+1,N).entries()){let w=y+x+1,O=`${N}-${w}-above`;i[O]={opt:0,[O]:1},s[O]={max:1},u[O]=1;let L=`${O}-span`;i[N][L]=1,i[w][L]=-1,i[O][L]=-d,s[L]={min:1-d,max:-1};for(let D of b.ichildren()){if(D===h)continue;let S=l.get(D),C=`${O}-${S}-cross`;i[C]={opt:1,[C]:1},s[C]={max:1},u[C]=1;let z=`${C}-left`;i[N][z]=-1,i[S][z]=1,i[O][z]=d,i[C][z]=-d,s[z]={max:d};let k=`${C}-right`;i[N][k]=-1,i[S][k]=1,i[O][k]=d,i[C][k]=d,s[k]={min:0}}}for(let y of h.ichildren())c.has(y)||c.set(y,N)}if(t){let N=a.reduce((h,x)=>h+x.children().length,0);for(let[h,x]of a.entries())for(let y of x.ichildren()){let b=l.get(y),w=`${h}-${b}-dist`;i[w]={opt:1/N};let O=`${w}-upper`;i[h][O]=1,i[b][O]=-1,i[w][O]=-d,s[O]={max:0};let L=`${w}-lower`;i[h][L]=1,i[b][L]=-1,i[w][L]=d,s[L]={min:0}}}let p=re("opt","min",i,s,u);if(t||e)for(let[N,h]of a.entries())h.x=(m=p[N])!=null?m:0;else{let N=new Set;for(let x of a.keys())N.add((v=p[x])!=null?v:0);let h=new Map(_([...N].sort(),(x,y)=>[x,y]));for(let[x,y]of a.entries())y.x=h.get((f=p[x])!=null?f:0)}}function n(a){return a===void 0?e:It(a,t)}r.compressed=n;function o(a){return a===void 0?t:It(e,a)}return r.dist=o,r}function So(...e){if(e.length)throw new Error(`got arguments to opt(${e}), but constructor takes no arguments.`);return It(!1,!0)}var cn=Ie(ln());function Bo(e,t,r,n,o){if(!t.length)return[];let a=[[0]],i=[0],s=[[0]],u=[0];for(let c of e){let p=[0];p.push(...c),a.push(p)}i.push(...t),s.push(...t.map(()=>[0]));for(let c of r)for(let[p,m]of c.entries())s[p+1].push(-m);u.push(...n.map(c=>-c));let{solution:l,message:d}=(0,cn.solveQP)(a,i,s,u,o);if(d.length)throw new Error(`quadratic program failed: ${d}`);return l.shift(),l}function je(e,t,r,n,o=0){t.pop(),e.pop(),e.forEach(i=>i.pop()),r.forEach(i=>i.pop());let a=Bo(e,t,r,n,o);return a.push(0),a}function fn(e){return new Map(e.flatMap(t=>t).map((t,r)=>[t,r]))}function He(e,t,r){let n=1+Math.max(...t.values()),o=[],a=[];for(let u of e)for(let[l,d]of Z(u)){let c=t.get(l),p=t.get(d),m=new Array(n).fill(0);m[c]=1,m[p]=-1,o.push(m),a.push(-(r(l)+r(d))/2)}let i=new Array(n).fill(0);return[[...new Array(n)].map(()=>new Array(n).fill(0)),i,o,a]}function zt(e,t,r,n){e[r][r]+=n,e[r][t]-=n,e[t][r]-=n,e[t][t]+=n}function Ze(e,t,r,n,o){e[n][n]+=o,e[n][r]-=2*o,e[n][t]+=o,e[r][n]-=2*o,e[r][r]+=4*o,e[r][t]-=2*o,e[t][n]+=o,e[t][r]-=2*o,e[t][t]+=o}function Qe(e,t,r,n){let o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;for(let s of e){let u=s[0],l=s[s.length-1];o=Math.min(o,n[r.get(u)]-t(u)/2),a=Math.max(a,n[r.get(l)]+t(l)/2)}let i=a-o;for(let s of e)for(let u of s)u.x=Math.min(Math.max(0,n[r.get(u)]-o),i);return i}function Je(e){let t=J(j(e,a=>a));function*r(a){var i;yield*a.ichildren(),yield*(i=t.get(a))!=null?i:[]}let n=0,o=new Map;for(let a of j(e,i=>i))if(!o.has(a)){for(let i of X(r,a))o.set(i,n);n++}return o}function Ke(e,t){let r=[],n=[],o=new Set;for(let a of e){let i=new Set(a.map(s=>t.get(s)));Yt(o,i)||r.push(n=[]),n.push(a),o=i}return r}function Ro(e){let[t,r,n]=e;if(t<=0||r<=0||n<=0)throw new Error("const accessors should return non-negative values");let o=()=>e;return o.value=e,o}function _o(e){return"value"in e&&typeof e.value=="object"&&e.value.length===3&&e.value.every(t=>typeof t=="number")}function Wo(e,t){if(_o(t)){let[r,n,o]=t.value;if(r<=0||n<=0||o<=0)throw new Error(`simplex weights must be positive, but got: ${r}, ${n}, ${o}`);return(i,s)=>{switch(+("node"in i.data)+ +("node"in s.data)){case 0:return o;case 1:return n;case 2:return r;default:throw new Error("internal error")}}}else{let r=new Map;for(let o of j(e,a=>a))if("node"in o.data){let a=o.data.node,i=new Map;for(let s of a.ichildLinks()){let{target:u}=s,l=t(s),[d,c,p]=l;if(d<=0||c<=0||p<=0)throw new Error(`simplex weights must be positive, but got: ${d}, ${c}, ${p}`);i.set(u,l)}r.set(a,i)}return(o,a)=>{if("link"in o.data){let{source:i,target:s}=o.data.link,[,u,l]=r.get(i).get(s);return"link"in a.data?l:u}else if("link"in a.data){let{source:i,target:s}=a.data.link,[,u]=r.get(i).get(s);return u}else{let[i]=r.get(o.data.node).get(a.data.node);return i}}}}function pn(e){function t(o,a){var v;let i={},s={},u=Wo(o,e.weight),l=new Map;for(let[f,N]of Q(j(o,h=>h))){let h=f.toString();l.set(N,h),i[h]={}}function d(f){return l.get(f)}for(let f of o)for(let[N,h]of Z(f)){let x=d(N),y=d(h),b=`layer ${x} -> ${y}`,w=(a(N)+a(h))/2;s[b]={min:w},i[x][b]=-1,i[y][b]=1}for(let f of j(o,N=>N)){let N=d(f);for(let h of f.ichildren()){let x=d(h),y=`link ${N} -> ${x}`,b=`${y} parent`;s[b]={min:0};let w=`${y} child`;s[w]={min:0},i[N][b]=1,i[N][w]=-1,i[x][b]=-1,i[x][w]=1;let O=u(f,h);i[y]={opt:O,[b]:1,[w]:1}}}let c=re("opt","min",i,s),p=0,m=0;for(let f of o){for(let x of f)x.x=(v=c[d(x)])!=null?v:0;let N=f[0];p=Math.min(p,N.x-a(N)/2);let h=f[f.length-1];m=Math.max(m,h.x+a(h)/2)}for(let f of j(o,N=>N))f.x-=p;return m-p}function r(o,a){let i=Je(o),s=Ke(o,i),u=s.map(d=>t(d,a)),l=Math.max(...u);if(l<=0)throw new Error("must assign nonzero width to at least one node");for(let[d,c]of s.entries()){let p=(l-u[d])/2;for(let m of c)for(let v of m)v.x+=p}return l}function n(o){if(o===void 0)return e.weight;{let a=e,{weight:i}=a,s=B(a,["weight"]);return pn(T(A({},s),{weight:o}))}}return r.weight=n,r}function Mt(...e){if(e.length)throw new Error(`got arguments to simplex(${e}), but constructor takes no arguments.`);return pn({weight:Ro([1,2,8])})}var At=class{constructor(){this.mean=0;this.count=0}add(t){this.mean+=(t-this.mean)/++this.count}val(){return this.count?this.mean:void 0}},$o=()=>new At,Tt=class{constructor(){this.vals=[]}add(t){this.vals.push(t)}val(){return ge(this.vals)}},Uo=()=>new Tt,Et=class{constructor(){this.vals=[]}add(t){this.vals.push(t)}val(){if(this.vals.sort((t,r)=>t-r),this.vals.length!==0){if(this.vals.length===2)return(this.vals[0]+this.vals[1])/2;if(this.vals.length%2===0){let t=this.vals.length/2,r=this.vals[0],n=this.vals[t-1],o=this.vals[t],a=this.vals[this.vals.length-1],i=n-r,s=a-o;return(n*s+o*i)/(i+s)}else return this.vals[(this.vals.length-1)/2]}}},mn=()=>new Et;function Go(e,t){let r=e();for(let n of t)r.add(n);return r.val()}function hn(e,t){let r=new Map;for(let d of e){let c=t.get(d);c!==void 0&&ue(r,c,d)}let n=[...r.entries()].sort(([d],[c])=>d-c).flatMap(([,d])=>d),o=new Map(e.map((d,c)=>[d,c])),a=e.filter(d=>t.get(d)===void 0),i=new Array(a.length).fill(null);function s(d,c,p,m){if(c<=d)return;let v=Math.floor((d+c)/2),f=a[v],N=o.get(f),h=0,x=[h];for(let b=p;b<m;++b)h+=o.get(n[b])<N?-1:1,x.push(h);let y=p+x.indexOf(Math.min(...x));i[v]=y,s(d,v,p,y),s(v+1,c,y,m)}s(0,a.length,0,n.length),i.push(n.length+1);let u=0,l=0;for(let[d,c]of n.entries()){for(;i[l]==d;)e[u++]=a[l++];e[u++]=c}for(;i[l]==n.length;)e[u++]=a[l++]}function gn({factory:e}){function t(n,o,a){if(a){let i=new Map(o.map(u=>[u,e()]));for(let[u,l]of n.entries())for(let d of l.ichildren())i.get(d).add(u);let s=new Map([...i.entries()].map(([u,l])=>[u,l.val()]));hn(o,s)}else{let i=new Map(o.map((u,l)=>[u,l])),s=new Map(n.map(u=>{let l=Go(e,_(u.ichildren(),d=>i.get(d)));return[u,l]}));hn(n,s)}}function r(n){return n===void 0?e:gn({factory:n})}return t.aggregator=r,t}function Vt(...e){if(e.length)throw new Error(`got arguments to agg(${e}), but constructor takes no arguments.`);return gn({factory:mn})}function vn(e,t){let r=new Map,n=new Map(e.map((a,i)=>[a,i]));function o(a,i){var u;let s=(u=r.get(a))==null?void 0:u.get(i);if(s!==void 0)return s;{let l=0;for(let p of t(a))for(let m of t(i))l+=Math.sign(n.get(p)-n.get(m));let d=r.get(a);d===void 0?r.set(a,new Map([[i,l]])):d.set(i,l);let c=r.get(i);return c===void 0?r.set(i,new Map([[a,-l]])):c.set(a,-l),l}}return o}function qo(e,t){let r=[[0,e.length]],n;for(;n=r.pop();){let[o,a]=n;if(o>=a)continue;let i=0,s=a;for(let u=o;u<a-1;++u){let l=t(e[u],e[u+1]);l>i&&(i=l,s=u)}s!==a&&([e[s],e[s+1]]=[e[s+1],e[s]],r.push([o,s],[s+2,a]))}}function Fo(e,t){let r=new Array(e.length*(e.length-1)/2);for(;;){let n=0;for(let u=1;u<e.length;++u){let l=0,d=n;for(let c=u-1;c>=0;--c)r[d]=l,l+=t(e[c],e[u]),d-=e.length-c-1;n+=e.length-u}let o=0,a=0,i=0,s=0;for(let u=0;u<e.length-1;++u){let l=0;for(let d=u+1;d<e.length;++d){l+=t(e[u],e[d]);let c=r[o++]+l;c>a&&(a=c,i=u,s=d)}}if(a===0)break;[e[i],e[s]]=[e[s],e[i]]}}function Pt({baseOp:e,doScan:t}){function r(a,i,s){e(a,i,s);let u,l;if(s){let d=J(a);l=vn(a,c=>{var p;return(p=d.get(c))!=null?p:[]}),u=i}else l=vn(i,d=>d.ichildren()),u=a;t?Fo(u,l):qo(u,l)}function n(a){return a===void 0?e:Pt({baseOp:a,doScan:t})}r.base=n;function o(a){return a===void 0?t:Pt({baseOp:e,doScan:a})}return r.scan=o,r}function Bt(...e){if(e.length)throw new Error(`got arguments to greedy(${e}), but constructor takes no arguments.`);return Pt({baseOp:()=>{},doScan:!1})}function jo(e){if(e.value===void 0)throw new Error(H`node with data '${e.data}' did not get a defined value during layering`);if(e.value<0)throw new Error(H`node with data '${e.data}' got an invalid (negative) value during layering: ${e.value}`);return e.value}function Rt(e){let t=new Map(_(e,i=>[i,{node:i,layer:jo(i)}]));for(let{source:i,target:s}of e.ilinks()){let u=i.nchildLinksTo(s)>1;if(u&&i.value+1>=s.value)throw new Error(H`layering left child data '${s.data}' (${s.value}) whose layer was not two more than its parent data '${i.data}' (${i.value})`);if(!u&&i.value>=s.value)throw new Error(H`layering left child data '${s.data}' (${s.value}) whose layer was not greater than its parent data '${i.data}' (${i.value})`)}function r(i){let s=i.layer+1;return("node"in i?i.node.childLinks():[i.link]).map(l=>{let d=t.get(l.target);return d.layer===s?d:{link:l,layer:s}})}let o=lt().children(r)(..._(e.iroots(),i=>t.get(i)));Ne(!o.multidag());let a=[];for(let i of o)(a[i.data.layer]||(a[i.data.layer]=[])).push(i);if(!a[0]||!a[0].length)throw new Error("no nodes were assigned to layer 0");for(let i of a)Ne(i&&i.length);return a}function _t(e){for(let t of e)for(let r of t){if("link"in r.data)continue;r.data.node.x=r.x,r.data.node.y=r.y;let n=new Map(_(r.data.node.ichildLinks(),({points:o,target:a})=>[a,o]));for(let o of r.ichildren()){let a=[{x:r.x,y:r.y}];for(;"link"in o.data;)a.push({x:o.x,y:o.y}),[o]=o.ichildren();a.push({x:o.x,y:o.y});let i=n.get(o.data.node);i.splice(0,i.length,...a)}}}function Nn(e,t){for(let r of e){let n=0;for(let o of r){if(o.x===void 0)throw new Error(H`coord didn't assign an x to node '${o}'`);if(o.x<n)throw new Error(H`coord assigned an x (${o.x}) smaller than a previous node in the layer '${o}'`);n=o.x}if(n>t)throw new Error(`coord assigned an x (${n}) greater than width (${t})`)}}function xn(e,t,r){for(let n of e)for(let o of n)o.x*=t,o.y*=r}function Ye(e){let t=0;for(let[r,n]of Z(e)){let o=new Map(n.map((a,i)=>[a,i]));for(let[a,i]of r.entries())for(let s of r.slice(a+1))for(let u of i.ichildren())for(let l of s.ichildren())u!==l&&o.get(u)>o.get(l)&&t++}return t}function bn(e){function t(n){let o;if(e.topDown)o=X(a=>a.ichildren(),...j(ke(n),a=>a));else{let a=J(j(n,i=>i));o=X(i=>{var s;return(s=a.get(i))!=null?s:[]},...j(n,i=>i))}for(let a of n)a.splice(0);for(let a of o)n[a.data.layer].push(a)}function r(n){return n===void 0?e.topDown:bn({topDown:n})}return t.topDown=r,t}function Xe(...e){if(e.length)throw new Error(`got arguments to dfs(${e}), but constructor takes no arguments.`);return bn({topDown:!0})}function et(e){function t(a){let i=a.slice().reverse(),s=a.map(l=>l.slice()),u=Ye(s);for(let l of e.inits){l(a);let d=!0;for(let c=0;c<e.passes&&d;++c){d=!1;for(let[v,f]of Z(a)){let N=f.slice();e.order(v,f,!0),f.some((h,x)=>N[x]!==h)&&(d=!0)}let p=Ye(a);p<u&&(u=p,s=a.map(v=>v.slice()));for(let[v,f]of Z(i)){let N=f.slice();e.order(f,v,!1),f.some((h,x)=>N[x]!==h)&&(d=!0)}let m=Ye(a);m<u&&(u=m,s=a.map(v=>v.slice()))}}a.splice(0,a.length,...s)}function r(a){if(a===void 0)return e.order;{let i=e,{order:s}=i,u=B(i,["order"]);return et(T(A({},u),{order:a}))}}t.order=r;function n(a){if(a===void 0)return[...e.inits];if(a.length){let i=e,{inits:s}=i,u=B(i,["inits"]);return et(T(A({},u),{inits:[...a]}))}else throw new Error("inits must be a non-empty array, maybe you intended the singleton noop: `[() => undefined]`")}t.inits=n;function o(a){if(a===void 0)return e.passes;if(a<=0)throw new Error("number of passes must be positive");return et(T(A({},e),{passes:a}))}return t.passes=o,t}function Wt(...e){if(e.length)throw new Error(`got arguments to twoLayer(${e}), but constructor takes no arguments.`);return et({order:Bt().base(Vt()),inits:[Xe(),Xe().topDown(!1)],passes:24})}function $t(e){function t(o){var N;let a={},i={},s={},u=new Map(_(o,(h,x)=>[h,x.toString()]));function l(h){return u.get(h)}function d(h){return a[l(h)]}function c(h,x,y,b=1){let w=d(x),O=d(y),L=`${h}: ${l(x)} -> ${l(y)}`;i[L]={min:b},w[L]=-1,O[L]=1}function p(h,x,y){c(`${h} before`,x,y,0),c(`${h} after`,y,x,0)}let m=[],v=new Map;for(let h of o){let x=l(h);s[x]=1,a[x]={opt:0};let y=e.rank(h);y!==void 0&&m.push([y,h]);let b=e.group(h);if(b!==void 0){let w=v.get(b);w?w.push(h):v.set(b,[h])}}for(let h of o)for(let[x,y]of h.ichildrenCounts())c("link",h,x,y>1?2:1),d(h).opt+=y,d(x).opt-=y;let f=m.sort(([h],[x])=>h-x);for(let[[h,x],[y,b]]of Z(f))h<y?c("rank",x,b):p("rank",x,b);for(let h of v.values())for(let[x,y]of Z(h))p("group",x,y);try{let h=re("opt","max",a,i,s);for(let x of o)x.value=(N=h[l(x)])!=null?N:0}catch(h){throw Ne(m.length||v.size),new Error("could not find a feasible simplex layout, check that rank or group accessors are not ill-defined")}}function r(o){if(o===void 0)return e.rank;{let a=e,{rank:i}=a,s=B(a,["rank"]);return $t(T(A({},s),{rank:o}))}}t.rank=r;function n(o){if(o===void 0)return e.group;{let a=e,{group:i}=a,s=B(a,["group"]);return $t(T(A({},s),{group:o}))}}return t.group=n,t}function On(){}function Ut(...e){if(e.length)throw new Error(`got arguments to simplex(${e}), but constructor takes no arguments.`);return $t({rank:On,group:On})}function wn(e){let t=e();function r(n){return"node"in n.data?e(n.data.node):t}return r.wrapped=e,r}function Ho(e,t=!0){let r=new Map;function n(i){let s=r.get(i);if(s===void 0){s=e(i);let[u,l]=s;if(t&&(u<0||l<0))throw new Error(H`all node sizes must be non-negative, but got width ${u} and height ${l} for node '${i}'`);r.set(i,s)}return s}return[i=>n(i)[0],i=>n(i)[1]]}function Dn(e,t){let r=0;for(let n of e){let o=Math.max(...n.map(t));for(let a of n)a.y=r+o/2;r+=o}return r}function le(e){function t(u){e.layering(u);let l=Rt(u),[d,c]=Ho(e.sugiNodeSize),p=Dn(l,c);if(p<=0)throw new Error("at least one node must have positive height, but total height was zero");e.decross(l);let m=e.coord(l,d);if(Nn(l,m),e.size!==null){let[v,f]=e.size;xn(l,v/m,f/p),m=v,p=f}return _t(l),{width:m,height:p}}function r(u){if(u===void 0)return e.layering;{let l=e,{layering:d}=l,c=B(l,["layering"]);return le(T(A({},c),{layering:u}))}}t.layering=r;function n(u){if(u===void 0)return e.decross;{let l=e,{decross:d}=l,c=B(l,["decross"]);return le(T(A({},c),{decross:u}))}}t.decross=n;function o(u){if(u===void 0)return e.coord;{let l=e,{coord:d}=l,c=B(l,["coord"]);return le(T(A({},c),{coord:u}))}}t.coord=o;function a(u){return u!==void 0?le(T(A({},e),{size:u})):e.size}t.size=a;function i(u){if(u!==void 0){let l=e,{nodeSize:d,sugiNodeSize:c}=l,p=B(l,["nodeSize","sugiNodeSize"]);return le(T(A({},p),{nodeSize:u,sugiNodeSize:wn(u)}))}else return e.nodeSize}t.nodeSize=i;function s(u){if(u!==void 0){let l=e,{sugiNodeSize:d,nodeSize:c}=l,p=B(l,["sugiNodeSize","nodeSize"]);return le(T(A({},p),{sugiNodeSize:u,nodeSize:null}))}else return e.sugiNodeSize}return t.sugiNodeSize=s,t}function yn(e){return[+(e!==void 0),1]}function Zo(...e){if(e.length)throw new Error(`got arguments to sugiyama(${e}), but constructor takes no arguments.`);return le({layering:Ut(),decross:Wt(),coord:Mt(),size:null,nodeSize:yn,sugiNodeSize:wn(yn)})}function Qo(...e){if(e.length)throw new Error(`got arguments to center(${e}), but constructor takes no arguments.`);function t(r,n){let o=r.map(i=>{let s=0;for(let u of i){let l=n(u);u.x=s+l/2,s+=l}return s}),a=Math.max(...o);if(a<=0)throw new Error("must assign nonzero width to at least one node");for(let[i,s]of r.entries()){let u=o[i],l=(a-u)/2;for(let d of s)d.x+=l}return a}return t}function Jo(...e){if(e.length)throw new Error(`got arguments to greedy(${e}), but constructor takes no arguments.`);function t(r,n){let o=Ko,a=new Map;for(let c of r)for(let p of c)a.set(p,p.nchildren()+("node"in p.data?0:-3));for(let c of r)for(let p of c)for(let m of p.ichildren())a.set(m,a.get(m)+1);let[i,...s]=r,u=0,l=0;for(let c of i){let p=n(c);c.x=l+p/2,l+=p}for(let c of s){o(i,c);let p=c.map((m,v)=>[v,m]).sort(([m,v],[f,N])=>{let h=a.get(v),x=a.get(N);return h===x?m-f:x-h});for(let[m,v]of p){let f=n(v),N=v.x+f/2;for(let x of c.slice(m+1)){let y=n(x)/2;N=(x.x=Math.max(x.x,N+y))+y}l=Math.max(l,N);let h=v.x-f/2;for(let x of c.slice(0,m).reverse()){let y=n(x)/2;h=(x.x=Math.min(x.x,h-y))-y}u=Math.min(u,h)}i=c}for(let c of r)for(let p of c)p.x-=u;let d=l-u;if(d<=0)throw new Error("must assign nonzero width to at least one node");return d}return t}function Ko(e,t){for(let n of t)n.x=0;let r=new Map;for(let n of e)for(let o of n.ichildren()){let a=(r.get(o)||0)+1;r.set(o,a),o.x+=(n.x-o.x)/a}}function se(e){if(e<0)throw new Error("const accessors should return non-negative values");let t=()=>e;return t.value=e,t}function ce(e){return"value"in e&&typeof e.value=="number"}function Yo(e,t){if(ce(e)){let r=e.value;for(let n of j(t,o=>o))if("node"in n.data){let o=n.data.node;for(let a of o.ichildLinks())if(e(a)!==r)throw new Error("passed in a vertWeak accessor with a `value` property that wasn't a const accessor")}return()=>r}else{let r=new Map;for(let n of j(t,o=>o))if("node"in n.data){let o=n.data.node,a=new Map(_(o.ichildLinks(),i=>[i.target,e(i)]));r.set(o,a)}return(n,o)=>r.get(n).get(o)}}function Ln(e){if(ce(e))return e;{let t=new Map;return r=>{let{source:n,target:o}=r,a=t.get(n);a===void 0&&(a=new Map,t.set(n,a));let i=a.get(o);if(i===void 0){let s=e(r);if(s<0)throw new Error("link weights must be non-negative");return a.set(o,s),s}else return i}}}function Xo(e){if(ce(e))return e;{let t=new Map;return r=>{let n=t.get(r);if(n===void 0){let o=e(r);if(o<0)throw new Error("node weights must be non-negative");return t.set(r,o),o}else return n}}}function ae(e){function t(d,c,p){var S;let{comp:m}=e,v=fn(d),[f,N,h,x]=He(d,v,c),y=Yo(e.vertWeak,d),b=Ln(e.vertStrong),w=Ln(e.linkCurve),O=Xo(e.nodeCurve);for(let C of j(d,z=>z)){let z=v.get(C),k=C.data,V="node"in k?k.node:k.link.source;for(let E of C.ichildren()){let P=v.get(E),M=E.data,$="node"in M?M.node:M.link.target,F="node"in k?y(V,$):b(k.link),q="node"in M?y(V,$):b(M.link),W="node"in M?O(M.node):w(M.link);zt(f,z,P,F+q);for(let ne of E.ichildren()){let Y=v.get(ne);Ze(f,z,P,Y,W)}}}let L=new Map;for(let C of d)for(let[z,k]of Z(C)){let V=p.get(z),E=p.get(k);if(V!==E){let P=L.get(V);P===void 0?L.set(V,new Set([E])):P.add(E)}}let D=new Map;for(let[C,z]of L.entries()){let k=new Set;for(let V of z){let E=X(M=>{var $;return($=L.get(M))!=null?$:[]},V);fe(E,M=>M===C)||k.add(V)}D.set(C,k)}for(let C of d)for(let[z,k]of Z(C)){let V=p.get(z),E=p.get(k);V!==E&&((S=D.get(V))==null?void 0:S.has(E))&&zt(f,v.get(z),v.get(k),m)}try{let C=je(f,N,h,x);return Qe(d,c,v,C)}catch(C){throw C instanceof Error&&C.message==="quadratic program failed: matrix D in quadratic function is not positive definite!"?new Error("quad objective wasn't well defined, this happens when too many of the weights were set to zero (or really small). Try changing the weight accessors to return nonzero values in more instances."):C}}function r(d,c){let p=Je(d),m=Ke(d,p),v=m.map(N=>t(N,c,p)),f=Math.max(...v);if(f<=0)throw new Error("must assign nonzero width to at least one node");for(let[N,h]of m.entries()){let x=(f-v[N])/2;for(let y of h)for(let b of y)b.x+=x}return f}function n(d){if(d===void 0){let{vertWeak:p,vertStrong:m}=e;return ce(p)&&ce(m)?[p.value,m.value]:null}else{let[p,m]=d;if(p<0||m<0)throw new Error(`weights must be non-negative, but were ${p} and ${m}`);{let c=e,{vertWeak:v,vertStrong:f}=c,N=B(c,["vertWeak","vertStrong"]);return ae(T(A({},N),{vertWeak:se(p),vertStrong:se(m)}))}}}r.vertical=n;function o(d){if(d===void 0)return e.vertWeak;{let c=e,{vertWeak:p}=c,m=B(c,["vertWeak"]);return ae(T(A({},m),{vertWeak:d}))}}r.vertWeak=o;function a(d){if(d===void 0)return e.vertStrong;{let c=e,{vertStrong:p}=c,m=B(c,["vertStrong"]);return ae(T(A({},m),{vertStrong:d}))}}r.vertStrong=a;function i(d){if(d===void 0){let{linkCurve:p,nodeCurve:m}=e;return ce(p)&&ce(m)?[m.value,p.value]:null}else{let[p,m]=d;if(p<0||m<0)throw new Error(`weights must be non-negative, but were ${p} and ${m}`);{let c=e,{linkCurve:v,nodeCurve:f}=c,N=B(c,["linkCurve","nodeCurve"]);return ae(T(A({},N),{linkCurve:se(m),nodeCurve:se(p)}))}}}r.curve=i;function s(d){if(d===void 0)return e.linkCurve;{let c=e,{linkCurve:p}=c,m=B(c,["linkCurve"]);return ae(T(A({},m),{linkCurve:d}))}}r.linkCurve=s;function u(d){if(d===void 0)return e.nodeCurve;{let c=e,{nodeCurve:p}=c,m=B(c,["nodeCurve"]);return ae(T(A({},m),{nodeCurve:d}))}}r.nodeCurve=u;function l(d){if(d===void 0)return e.comp;if(d<=0)throw new Error(`weight must be positive, but was ${d}`);return ae(T(A({},e),{comp:d}))}return r.component=l,r}function ei(...e){if(e.length)throw new Error(`got arguments to quad(${e}), but constructor takes no arguments.`);return ae({vertWeak:se(1),vertStrong:se(0),linkCurve:se(1),nodeCurve:se(0),comp:1})}function ti(...e){if(e.length)throw new Error(`got arguments to topological(${e}), but constructor takes no arguments.`);function t(r,n){for(let p of r)if(p.reduce((v,f)=>v+ +("node"in f.data),0)!==1)throw new Error("topological() only works with a topological layering");let o=new Map,a=0;for(let p of r)for(let m of p)"link"in m.data&&o.set(m,a++);for(let p of r)for(let m of p)"node"in m.data&&o.set(m,a);let[i,s,u,l]=He(r,o,n);for(let p of r)for(let m of p){let v=o.get(m);for(let f of m.ichildren()){let N=o.get(f);if("link"in f.data)for(let h of f.ichildren()){let x=o.get(h);Ze(i,v,N,x,1)}}}let d=je(i,s,u,l),c=Qe(r,n,o,d);if(c<=0)throw new Error("must assign nonzero width to at least one node");return c}return t}function Gt(e){function t(o){let a=o.reduce((b,w)=>b+w.length*Math.max(w.length-1,0)/2,0),i=o.reduce((b,w)=>b+w.reduce((O,L)=>O+L.nchildren(),0),0);if(e.large!=="large"&&a>1200)throw new Error('size of dag to decrossOpt is too large and will likely crash instead of complete, enable "large" graphs to run anyway');if(e.large!=="large"&&e.large!=="medium"&&(a>400||i>100))throw new Error('size of dag to decrossOpt is too large and will likely not complete, enable "medium" graphs to run anyway');let s=[];for(let[b,w]of Z(o)){let O=new Set(b.flatMap(k=>k.children())),L=w.filter(k=>!O.has(k)),D=b.map(k=>k.children()).filter(k=>k.length>1);s.push([L,D]);let S=b.filter(k=>!k.nchildren()),z=[...J(b).values()];s.push([S,z])}let u=s.reduce((b,[w,O])=>O.reduce((L,D)=>L+D.length*D.length,0)*w.length,0)/4,l=1/(u+1),d=l/(a+1),c={},p={},m={},v=new Map;{let b=0;for(let w of o)for(let O of w)v.set(O,b++)}function f(...b){return b.map(w=>v.get(w)).sort((w,O)=>w-O).join(" => ")}function N(b){for(let[w,O]of b.slice(0,b.length-1).entries())for(let L of b.slice(w+1)){let D=f(O,L);m[D]=1,p[D]={max:1},c[D]={opt:-d,[D]:1}}for(let[w,O]of b.slice(0,b.length-1).entries())for(let[L,D]of b.slice(w+1).entries())for(let S of b.slice(w+L+2)){let C=f(O,D),z=f(O,S),k=f(D,S),V=f(O,D,S),E=V+"+";p[E]={max:1},c[C][E]=1,c[z][E]=-1,c[k][E]=1;let P=V+"-";p[P]={min:0},c[C][P]=1,c[z][P]=-1,c[k][P]=1}}function h(b){for(let[w,O]of b.slice(0,b.length-1).entries())for(let L of b.slice(w+1)){let D=f(O,L);for(let S of O.ichildren())for(let C of L.ichildren()){if(S===C)continue;let z=f(S,C),k=`slack (${D}) (${z})`,V=`${k} +`,E=`${k} -`;c[k]={opt:1,[V]:1,[E]:1};let P=Math.sign(v.get(S)-v.get(C)),M=Math.max(P,0);p[V]={min:M},c[D][V]=1,c[z][V]=P,p[E]={min:-M},c[D][E]=-1,c[z][E]=-P}}}function x(b,w){for(let O of b)for(let L of w)for(let[D,S]of L.entries())for(let C of L.slice(D+1)){let k=`dist ${[S,O,C].map(M=>v.get(M)).join(" => ")}`,V=`${k} normal`,E=`${k} reversed`;c[k]={opt:l,[V]:1,[E]:1};let P=0;for(let[M,$]of[[S,O],[S,C],[O,C]]){let F=f(M,$),q=Math.sign(v.get(M)-v.get($));P+=+(q>0),c[F][V]=-q,c[F][E]=q}p[V]={min:1-P},p[E]={min:P-2}}}for(let b of o)N(b);for(let b of o.slice(0,o.length-1))h(b);if(e.dist)for(let[b,w]of s)x(b,w);let y=re("opt","min",c,p,m);for(let b of o)b.sort((w,O)=>y[f(w,O)]||-1)}function r(o){return o===void 0?e.large:Gt(T(A({},e),{large:o}))}t.large=r;function n(o){return o===void 0?e.dist:Gt(T(A({},e),{dist:o}))}return t.dist=n,t}function ri(...e){if(e.length)throw new Error(`got arguments to opt(${e}), but constructor takes no arguments.`);return Gt({large:"small",dist:!1})}var Cn=Ie(it());function Sn(e){function t(n){var m;let o=e.width||Math.floor(Math.sqrt(n.size()+.5));function a([v],[f]){for(let[N,h]of v.entries()){let x=f[N];if(x===void 0)return!1;if(h<x)return!0;if(x<h)return!1}return!0}let i=new Cn.default(a),s=new Map(_(n,v=>[v,[]])),u=Ae(n);for(let v of n.iroots())i.add([[],v]);let l=0,d=0,c=0,p;for(;p=i.poll();){let[,v]=p,f=(m=u.get(v))==null?void 0:m.reduce((N,[h,x])=>Math.max(N,h.value+ +(x>1)),0);c<o&&(f===void 0||f<d)?(v.value=d,c++):(v.value=d=Math.max(f!=null?f:0,d)+1,c=1);for(let N of v.ichildren()){let h=s.get(N);h.push(l),h.length===u.get(N).length&&i.add([h.reverse(),N])}l++}}function r(n){if(n===void 0)return e.width;if(n<0)throw new Error(`width must be non-negative: ${n}`);return Sn(T(A({},e),{width:n}))}return t.width=r,t}function ni(...e){if(e.length)throw new Error(`got arguments to coffmanGraham(${e}), but constructor takes no arguments.`);return Sn({width:0})}function In(e){function t(n){var o;if(e.topDown){let a=Ae(n);for(let i of n.idescendants("before"))i.value=Math.max(0,..._((o=a.get(i))!=null?o:[],([s,u])=>s.value+(u>1?2:1)))}else{let a=0;for(let i of n.idescendants("after"))i.value=Math.max(0,..._(i.ichildrenCounts(),([s,u])=>s.value+(u>1?2:1))),a=Math.max(a,i.value);for(let i of n)i.value=a-i.value}}function r(n){return n===void 0?e.topDown:In(T(A({},e),{topDown:n}))}return t.topDown=r,t}function oi(...e){if(e.length)throw new Error(`got arguments to longestPath(${e}), but constructor takes no arguments.`);return In({topDown:!0})}function ii(...e){if(e.length)throw new Error(`got arguments to topological(${e}), but constructor takes no arguments.`);function t(r){let n=0,o;for(let a of r.idescendants("before"))o!==void 0&&o.nchildLinksTo(a)>1&&++n,a.value=n++,o=a}return t}function qt(e){function t(o,a,i){let s=i?a:o,u=s.length*Math.max(s.length-1,0)/2,l=o.reduce((L,D)=>L+D.nchildren(),0);if(e.large!=="large"&&u>1200)throw new Error('size of dag to twolayerOpt is too large and will likely crash, enable "large" dags to run anyway');if(e.large!=="large"&&e.large!=="medium"&&(u>400||l>100))throw new Error('size of dag to twolayerOpt is too large and will likely not finish, enable "medium" dags to run anyway');let d={},c={},p={},m=new Map(s.map((L,D)=>[L,D]));function v(...L){return L.map(D=>m.get(D)).sort((D,S)=>D-S).join(" => ")}let f,N;if(i){let L=new Set(o.flatMap(D=>D.children()));f=a.filter(D=>!L.has(D)),N=o.map(D=>D.children()).filter(D=>D.length>1)}else f=o.filter(D=>!D.nchildren()),N=[...J(o).values()];let x=N.reduce((L,D)=>L+D.length*D.length,0)*f.length/4,y=1/(x+1),b=y/(u+1),w=new Map(a.map((L,D)=>[L,D]));for(let[L,D]of s.slice(0,s.length-1).entries())for(let S of s.slice(L+1)){let C=v(D,S);p[C]=1,c[C]={max:1},d[C]={opt:-b,[C]:1}}for(let[L,D]of s.slice(0,s.length-1).entries())for(let[S,C]of s.slice(L+1).entries())for(let z of s.slice(L+S+2)){let k=v(D,C),V=v(D,z),E=v(C,z),P=v(D,C,z),M=P+"+";c[M]={max:1},d[k][M]=1,d[V][M]=-1,d[E][M]=1;let $=P+"-";c[$]={min:0},d[k][$]=1,d[V][$]=-1,d[E][$]=1}for(let[L,D]of o.slice(0,o.length-1).entries())for(let S of o.slice(L+1))for(let C of D.ichildren())for(let z of S.ichildren()){if(C===z)continue;let k=i?v(C,z):v(D,S);d[k].opt+=Math.sign(w.get(C)-w.get(z))}if(e.dist)for(let L of f)for(let D of N)for(let[S,C]of D.entries())for(let z of D.slice(S+1)){let V=`dist ${[C,L,z].map($=>m.get($)).join(" => ")}`,E=`${V} normal`,P=`${V} reversed`;d[V]={opt:y,[E]:1,[P]:1};let M=0;for(let[$,F]of[[C,L],[C,z],[L,z]]){let q=v($,F),W=Math.sign(m.get($)-m.get(F));M+=+(W>0),d[q][E]=-W,d[q][P]=W}c[E]={min:1-M},c[P]={min:M-2}}let O=re("opt","min",d,c,p);s.sort((L,D)=>O[v(L,D)]||-1)}function r(o){return o===void 0?e.large:qt(T(A({},e),{large:o}))}t.large=r;function n(o){return o===void 0?e.dist:qt(T(A({},e),{dist:o}))}return t.dist=n,t}function ai(...e){if(e.length)throw new Error(`got arguments to opt(${e}), but constructor takes no arguments.`);return qt({large:"small",dist:!1})}function kn(e,t){let r=e.findIndex(n=>n<=t);return r>=0?r:e.length}function zn(e){var i;let t=new Map(e),r=[];for(let[s,[u,l]]of e.entries()){let d=!1,c=(i=e[s+1])==null?void 0:i[0];for(let[p,{target:m}]of Q(u.ichildLinks())){let v=t.get(m);c===m&&!d?d=!0:r.push([l,v,u,p])}}r.sort(([s,u],[l,d])=>u===d?l-s:u-d);let n=new Map,o=[],a=[];for(let[s,u,l,d]of r){let c=n.get(l);c===void 0&&(c=[],n.set(l,c));let p=kn(a,s),m=kn(o,s);p<m?(c[d]=-p-1,a[p]=u-1):(c[d]=m+1,o[m]=u-1)}return n}function Ft(e,t,r,n){function o(s){var h;let u=[],l=0,d;for(let x of s.idescendants("before"))d!==void 0&&d.nchildLinksTo(x)>1&&++l,u.push([x,l++]),d=x;let c=zn(u),p=0,m=0;for(let x of c.values())for(let y of x)y!==void 0&&(p=Math.min(p,y),m=Math.max(m,y));let v=-p*r+e/2;for(let[x,y]of u)x.x=v,x.y=(y+.5)*t;for(let x of s){let y=(h=c.get(x))!=null?h:[];for(let[b,{target:w,points:O}]of Q(x.ichildLinks())){O.length=0,O.push({x:x.x,y:x.y});let L=y[b];if(L!==void 0){let D=(L-p+.5)*r+(L>0?e-r:0),S=x.y+t,C=w.y-t;C-S>t/2?O.push({x:D,y:S},{x:D,y:C}):O.push({x:D,y:S})}O.push({x:w.x,y:w.y})}}let f=(m-p)*r+e,N=l*t;if(n===null)return{width:f,height:N};{let[x,y]=n;for(let[b]of u)b.x*=x/f,b.y*=y/N;for(let{points:b}of s.ilinks()){let w=b.map(({x:O,y:L})=>({x:O*x/f,y:L*y/N}));b.splice(0,b.length,...w)}return{width:x,height:y}}}function a(s){if(s===void 0)return[e,t,r];{let[u,l,d]=s;return Ft(u,l,d,n)}}o.nodeSize=a;function i(s){if(s!==void 0)return Ft(e,t,r,s);if(n===null)return n;{let[u,l]=n;return[u,l]}}return o.size=i,o}function si(...e){if(e.length)throw new Error(`got arguments to zherebko(${e}), but constructor takes no arguments.`);return Ft(1,1,1,null)}export{$o as aggMeanFactory,Uo as aggMedianFactory,mn as aggWeightedMedianFactory,Qo as coordCenter,Jo as coordGreedy,ei as coordQuad,Mt as coordSimplex,ti as coordTopological,Kn as dagConnect,lt as dagHierarchy,oo as dagStratify,Xe as decrossDfs,ri as decrossOpt,Wt as decrossTwoLayer,lo as grid,mt as laneGreedy,So as laneOpt,ni as layeringCoffmanGraham,oi as layeringLongestPath,Ut as layeringSimplex,ii as layeringTopological,Dn as sugiCoordVertical,Rt as sugify,Zo as sugiyama,Vt as twolayerAgg,Bt as twolayerGreedy,ai as twolayerOpt,_t as unsugify,si as zherebko};
